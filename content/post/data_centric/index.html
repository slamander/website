<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="J. Alex Baecher">
<meta name="dcterms.date" content="2025-11-22">

<title>Spatial Structures in Ecological Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-this-document-will-cover" id="toc-what-this-document-will-cover" class="nav-link active" data-scroll-target="#what-this-document-will-cover">What this document will cover:</a>
  <ul class="collapse">
  <li><a href="#why-include-spatial-structures-in-your-model" id="toc-why-include-spatial-structures-in-your-model" class="nav-link" data-scroll-target="#why-include-spatial-structures-in-your-model">Why include spatial structures in your model?</a></li>
  <li><a href="#how-to-account-for-spatial-autocorrelation-in-my-model" id="toc-how-to-account-for-spatial-autocorrelation-in-my-model" class="nav-link" data-scroll-target="#how-to-account-for-spatial-autocorrelation-in-my-model">How to account for spatial autocorrelation in my model?</a></li>
  </ul></li>
  <li><a href="#point-referenced-data" id="toc-point-referenced-data" class="nav-link" data-scroll-target="#point-referenced-data">1. Point-Referenced Data</a>
  <ul class="collapse">
  <li><a href="#what-is-point-referenced-data" id="toc-what-is-point-referenced-data" class="nav-link" data-scroll-target="#what-is-point-referenced-data">What is Point-Referenced Data?</a></li>
  <li><a href="#point-referenced-data-the-core-challenge" id="toc-point-referenced-data-the-core-challenge" class="nav-link" data-scroll-target="#point-referenced-data-the-core-challenge">Point-Referenced data: The Core Challenge</a></li>
  <li><a href="#point-referenced-data-five-approaches" id="toc-point-referenced-data-five-approaches" class="nav-link" data-scroll-target="#point-referenced-data-five-approaches">Point-Referenced data: Five Approaches</a></li>
  <li><a href="#understanding-the-gp-family-tree" id="toc-understanding-the-gp-family-tree" class="nav-link" data-scroll-target="#understanding-the-gp-family-tree">Understanding the GP Family Tree</a></li>
  <li><a href="#method-1-full-gaussian-processes" id="toc-method-1-full-gaussian-processes" class="nav-link" data-scroll-target="#method-1-full-gaussian-processes">Method 1: Full Gaussian Processes</a></li>
  </ul></li>
  <li><a href="#practical-advice" id="toc-practical-advice" class="nav-link" data-scroll-target="#practical-advice">Practical Advice</a>
  <ul class="collapse">
  <li><a href="#method-2-spde-approximation" id="toc-method-2-spde-approximation" class="nav-link" data-scroll-target="#method-2-spde-approximation">Method 2: SPDE Approximation</a></li>
  <li><a href="#method-3-low-rank-gaussian-processes" id="toc-method-3-low-rank-gaussian-processes" class="nav-link" data-scroll-target="#method-3-low-rank-gaussian-processes">Method 3: Low-Rank Gaussian Processes</a></li>
  <li><a href="#low-rank-gp-predictive-processes" id="toc-low-rank-gp-predictive-processes" class="nav-link" data-scroll-target="#low-rank-gp-predictive-processes">Low-Rank GP: Predictive Processes</a></li>
  <li><a href="#method-4-nearest-neighbor-gaussian-processes" id="toc-method-4-nearest-neighbor-gaussian-processes" class="nav-link" data-scroll-target="#method-4-nearest-neighbor-gaussian-processes">Method 4: Nearest Neighbor Gaussian Processes</a></li>
  <li><a href="#method-5-spatial-splines" id="toc-method-5-spatial-splines" class="nav-link" data-scroll-target="#method-5-spatial-splines">Method 5: Spatial Splines</a></li>
  </ul></li>
  <li><a href="#when-to-use-splines" id="toc-when-to-use-splines" class="nav-link" data-scroll-target="#when-to-use-splines">When to Use Splines</a></li>
  <li><a href="#common-pitfalls-and-solutions" id="toc-common-pitfalls-and-solutions" class="nav-link" data-scroll-target="#common-pitfalls-and-solutions">Common Pitfalls and Solutions</a></li>
  <li><a href="#watch-out-for" id="toc-watch-out-for" class="nav-link" data-scroll-target="#watch-out-for">Watch Out For:</a></li>
  <li><a href="#interpretation-challenge" id="toc-interpretation-challenge" class="nav-link" data-scroll-target="#interpretation-challenge">Interpretation Challenge</a></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics">Advanced Topics</a></li>
  <li><a href="#resources-and-further-reading" id="toc-resources-and-further-reading" class="nav-link" data-scroll-target="#resources-and-further-reading">Resources and Further Reading</a></li>
  <li><a href="#areal-lattice-data" id="toc-areal-lattice-data" class="nav-link" data-scroll-target="#areal-lattice-data">2. Areal / Lattice Data</a>
  <ul class="collapse">
  <li><a href="#what-is-areal-data" id="toc-what-is-areal-data" class="nav-link" data-scroll-target="#what-is-areal-data">What is Areal Data?</a></li>
  </ul></li>
  <li><a href="#common-questions" id="toc-common-questions" class="nav-link" data-scroll-target="#common-questions">Common Questions</a>
  <ul class="collapse">
  <li><a href="#areal-data-method-1---car-models" id="toc-areal-data-method-1---car-models" class="nav-link" data-scroll-target="#areal-data-method-1---car-models">Areal Data: Method 1 - CAR Models</a></li>
  <li><a href="#areal-data-method-2---proper-car" id="toc-areal-data-method-2---proper-car" class="nav-link" data-scroll-target="#areal-data-method-2---proper-car">Areal Data: Method 2 - Proper CAR</a></li>
  <li><a href="#areal-data-method-3---bym-model" id="toc-areal-data-method-3---bym-model" class="nav-link" data-scroll-target="#areal-data-method-3---bym-model">Areal Data: Method 3 - BYM Model</a></li>
  <li><a href="#areal-data-method-4---sar-models" id="toc-areal-data-method-4---sar-models" class="nav-link" data-scroll-target="#areal-data-method-4---sar-models">Areal Data: Method 4 - SAR Models</a></li>
  <li><a href="#areal-data-method-5---spatial-eigenvectors" id="toc-areal-data-method-5---spatial-eigenvectors" class="nav-link" data-scroll-target="#areal-data-method-5---spatial-eigenvectors">Areal Data: Method 5 - Spatial Eigenvectors</a></li>
  </ul></li>
  <li><a href="#point-pattern-data" id="toc-point-pattern-data" class="nav-link" data-scroll-target="#point-pattern-data">3. Point Pattern Data</a>
  <ul class="collapse">
  <li><a href="#what-is-point-pattern-data" id="toc-what-is-point-pattern-data" class="nav-link" data-scroll-target="#what-is-point-pattern-data">What is Point Pattern Data?</a></li>
  <li><a href="#point-pattern-core-concept---intensity" id="toc-point-pattern-core-concept---intensity" class="nav-link" data-scroll-target="#point-pattern-core-concept---intensity">Point Pattern: Core Concept - Intensity</a></li>
  <li><a href="#point-pattern-method-1---inhomogeneous-poisson-process" id="toc-point-pattern-method-1---inhomogeneous-poisson-process" class="nav-link" data-scroll-target="#point-pattern-method-1---inhomogeneous-poisson-process">Point Pattern: Method 1 - Inhomogeneous Poisson Process</a></li>
  <li><a href="#point-pattern-method-2---cox-processes" id="toc-point-pattern-method-2---cox-processes" class="nav-link" data-scroll-target="#point-pattern-method-2---cox-processes">Point Pattern: Method 2 - Cox Processes</a></li>
  <li><a href="#point-pattern-method-3---interaction-models" id="toc-point-pattern-method-3---interaction-models" class="nav-link" data-scroll-target="#point-pattern-method-3---interaction-models">Point Pattern: Method 3 - Interaction Models</a></li>
  </ul></li>
  <li><a href="#movement-trajectory-data" id="toc-movement-trajectory-data" class="nav-link" data-scroll-target="#movement-trajectory-data">3. Movement / Trajectory Data</a>
  <ul class="collapse">
  <li><a href="#what-is-movement-data" id="toc-what-is-movement-data" class="nav-link" data-scroll-target="#what-is-movement-data">What is Movement Data?</a></li>
  </ul></li>
  <li><a href="#key-questions" id="toc-key-questions" class="nav-link" data-scroll-target="#key-questions">Key Questions</a>
  <ul class="collapse">
  <li><a href="#movement-data-method-1---step-selection-functions" id="toc-movement-data-method-1---step-selection-functions" class="nav-link" data-scroll-target="#movement-data-method-1---step-selection-functions">Movement Data: Method 1 - Step Selection Functions</a></li>
  <li><a href="#movement-data-method-2---state-space-models" id="toc-movement-data-method-2---state-space-models" class="nav-link" data-scroll-target="#movement-data-method-2---state-space-models">Movement Data: Method 2 - State-Space Models</a></li>
  <li><a href="#movement-data-method-3---continuous-time-models" id="toc-movement-data-method-3---continuous-time-models" class="nav-link" data-scroll-target="#movement-data-method-3---continuous-time-models">Movement Data: Method 3 - Continuous-Time Models</a></li>
  <li><a href="#movement-data-method-4---integrated-models" id="toc-movement-data-method-4---integrated-models" class="nav-link" data-scroll-target="#movement-data-method-4---integrated-models">Movement Data: Method 4 - Integrated Models</a></li>
  </ul></li>
  <li><a href="#integrating-across-data-types" id="toc-integrating-across-data-types" class="nav-link" data-scroll-target="#integrating-across-data-types">Integrating Across Data Types</a>
  <ul class="collapse">
  <li><a href="#multi-scale-multi-type-integration" id="toc-multi-scale-multi-type-integration" class="nav-link" data-scroll-target="#multi-scale-multi-type-integration">Multi-Scale / Multi-Type Integration</a></li>
  <li><a href="#integration-approach-1-change-of-support" id="toc-integration-approach-1-change-of-support" class="nav-link" data-scroll-target="#integration-approach-1-change-of-support">Integration Approach 1: Change of Support</a></li>
  <li><a href="#integration-approach-2-joint-likelihood-models" id="toc-integration-approach-2-joint-likelihood-models" class="nav-link" data-scroll-target="#integration-approach-2-joint-likelihood-models">Integration Approach 2: Joint Likelihood Models</a></li>
  <li><a href="#integration-approach-3-spatial-misalignment" id="toc-integration-approach-3-spatial-misalignment" class="nav-link" data-scroll-target="#integration-approach-3-spatial-misalignment">Integration Approach 3: Spatial Misalignment</a></li>
  </ul></li>
  <li><a href="#model-selection-and-validation" id="toc-model-selection-and-validation" class="nav-link" data-scroll-target="#model-selection-and-validation">Model Selection and Validation</a>
  <ul class="collapse">
  <li><a href="#validation-for-spatial-data" id="toc-validation-for-spatial-data" class="nav-link" data-scroll-target="#validation-for-spatial-data">Validation for Spatial Data</a></li>
  </ul></li>
  <li><a href="#critical-issue" id="toc-critical-issue" class="nav-link" data-scroll-target="#critical-issue">Critical Issue</a>
  <ul class="collapse">
  <li><a href="#model-comparison-for-spatial-models" id="toc-model-comparison-for-spatial-models" class="nav-link" data-scroll-target="#model-comparison-for-spatial-models">Model Comparison for Spatial Models</a></li>
  </ul></li>
  <li><a href="#computational-considerations" id="toc-computational-considerations" class="nav-link" data-scroll-target="#computational-considerations">Computational Considerations</a>
  <ul class="collapse">
  <li><a href="#software-summary" id="toc-software-summary" class="nav-link" data-scroll-target="#software-summary">Software Summary</a></li>
  </ul></li>
  <li><a href="#recommended-workflow" id="toc-recommended-workflow" class="nav-link" data-scroll-target="#recommended-workflow">Recommended Workflow</a>
  <ul class="collapse">
  <li><a href="#common-pitfalls" id="toc-common-pitfalls" class="nav-link" data-scroll-target="#common-pitfalls">Common Pitfalls</a></li>
  </ul></li>
  <li><a href="#watch-out-for-1" id="toc-watch-out-for-1" class="nav-link" data-scroll-target="#watch-out-for-1">Watch Out For:</a>
  <ul class="collapse">
  <li><a href="#when-to-use-each-data-type-approach" id="toc-when-to-use-each-data-type-approach" class="nav-link" data-scroll-target="#when-to-use-each-data-type-approach">When to Use Each Data Type Approach</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#remember" id="toc-remember" class="nav-link" data-scroll-target="#remember">Remember:</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions?</a></li>
  <li><a href="#contact-discussion" id="toc-contact-discussion" class="nav-link" data-scroll-target="#contact-discussion">Contact &amp; Discussion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spatial Structures in Ecological Models</h1>
  <div class="quarto-categories">
    <div class="quarto-category">r tutorials</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>J. Alex Baecher </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="featured.png" class="img-fluid"></p>
<section id="what-this-document-will-cover" class="level2">
<h2 class="anchored" data-anchor-id="what-this-document-will-cover">What this document will cover:</h2>
<pre><code>Spatial structures  
‚îú‚îÄ‚îÄ Why go spatial?  
‚îÇ   ‚îî‚îÄ‚îÄ autocorrelation  
‚îú‚îÄ‚îÄ How to go spatial?
‚îÇ   ‚îî‚îÄ‚îÄ Background, examples, and considerations by data type
‚îÇ       ‚îú‚îÄ‚îÄ Point referenced data  
‚îÇ       ‚îú‚îÄ‚îÄ Areal data  
‚îÇ       ‚îú‚îÄ‚îÄ Point-pattern data  
‚îÇ       ‚îî‚îÄ‚îÄ Movement data  
‚îú‚îÄ‚îÄ What about mixed data types?  
‚îÇ   ‚îú‚îÄ‚îÄ Change of support  
‚îÇ   ‚îú‚îÄ‚îÄ Joint likelihoods  
‚îÇ   ‚îî‚îÄ‚îÄ Spatial misalignment  
‚îú‚îÄ‚îÄ What about model selection?  
‚îÇ   ‚îî‚îÄ‚îÄ Spatial validation methods  
‚îú‚îÄ‚îÄ What to watch out for?  
‚îÇ   ‚îú‚îÄ‚îÄ Common pitfalls  
‚îÇ   ‚îú‚îÄ‚îÄ Computational limitation  
‚îÇ   ‚îî‚îÄ‚îÄ Software considerations  
‚îî‚îÄ‚îÄ Resources  </code></pre>
<hr>
<section id="why-include-spatial-structures-in-your-model" class="level3">
<h3 class="anchored" data-anchor-id="why-include-spatial-structures-in-your-model">Why include spatial structures in your model?</h3>
<section id="toblers-first-law-geography-a.k.a.-spatial-autocorrelation" class="level4">
<h4 class="anchored" data-anchor-id="toblers-first-law-geography-a.k.a.-spatial-autocorrelation">Tobler‚Äôs First law Geography (a.k.a. <em>spatial autocorrelation</em>):</h4>
<blockquote class="blockquote">
<p>[‚Ä¶] everything is related to everything else, but near things are more related than distant things.‚Äù<br>
- Waldo Tobler 1970 <a href="https://doi.org/10.2307/143141">(link to paper)</a></p>
</blockquote>
<p>Put more explicitely: <em>measurements of ecological phenomena are more interconnected at close distances versus distant ones</em></p>
<p><img src="images/tobler.png" class="img-fluid"></p>
<section id="further-ignoring-spatial-autocorrelation-leads-to" class="level5">
<h5 class="anchored" data-anchor-id="further-ignoring-spatial-autocorrelation-leads-to">Further: Ignoring spatial autocorrelation leads to‚Ä¶</h5>
<ul>
<li>Biased parameter estimates</li>
<li>Inflated significance (increased chance of Type-I error)</li>
<li>Reduced model precision</li>
<li>Inaccurate model selection</li>
<li>Violated statistical assumptions (iid errors)</li>
<li>Poor predictive accuracy</li>
<li><em>Non-demonic</em> intrusion üòà</li>
</ul>
<hr>
</section>
</section>
</section>
<section id="how-to-account-for-spatial-autocorrelation-in-my-model" class="level3">
<h3 class="anchored" data-anchor-id="how-to-account-for-spatial-autocorrelation-in-my-model">How to account for spatial autocorrelation in my model?</h3>
<section id="first-what-type-of-spatial-data-do-you-have" class="level4">
<h4 class="anchored" data-anchor-id="first-what-type-of-spatial-data-do-you-have">First, what type of spatial data do you have?</h4>
<p>Each data type has specialized methods, assumptions, and computational considerations.</p>
<section id="data-types" class="level5">
<h5 class="anchored" data-anchor-id="data-types">Data types:</h5>
<ol type="1">
<li><strong>Point-Referenced Data</strong> (geostatistical data)</li>
<li><strong>Areal/Lattice Data</strong> (regional/grid data)<br>
</li>
<li><strong>Point Pattern Data</strong> (locations are the response)</li>
<li><strong>Movement/Trajectory Data</strong> (tracks and telemetry)</li>
</ol>
<p>Note: Many ecological studies combine multiple data types! We‚Äôll breifly discuss integration approaches.</p>
<hr>
</section>
</section>
</section>
</section>
<section id="point-referenced-data" class="level2">
<h2 class="anchored" data-anchor-id="point-referenced-data">1. Point-Referenced Data</h2>
<p><em>Measurements at specific geographic coordinates</em></p>
<section id="what-is-point-referenced-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-point-referenced-data">What is Point-Referenced Data?</h3>
<p><strong>Definition:</strong> Observations collected at specific locations, representing a continuous spatial process.</p>
<p><strong>Ecological Examples:</strong></p>
<ul>
<li>Species abundance at survey points</li>
<li>Vegetation cover at plot locations</li>
<li>Soil samples across a landscape</li>
<li>Individual tree measurements in a forest</li>
</ul>
<p><strong>Key characteristic:</strong> Locations are <strong>fixed by design</strong>, not random.</p>
<section id="a-visual-example" class="level4">
<h4 class="anchored" data-anchor-id="a-visual-example">A visual example</h4>
<p><strong>Typical scenario:</strong></p>
<ul>
<li>50-5000 sampling locations<br>
</li>
<li>Environmental covariates at each point<br>
</li>
<li>Response variable (abundance, presence, etc.)<br>
</li>
<li>Want to predict across unsampled locations</li>
</ul>
<p><strong>Common Questions</strong></p>
<ul>
<li>How does my response vary across space?<br>
</li>
<li>What drives spatial patterns?<br>
</li>
<li>Can I predict to new locations?<br>
</li>
<li>Is there residual spatial autocorrelation?</li>
</ul>
<p><img src="images/point%20presences.png" class="img-fluid"></p>
<hr>
</section>
</section>
<section id="point-referenced-data-the-core-challenge" class="level3">
<h3 class="anchored" data-anchor-id="point-referenced-data-the-core-challenge">Point-Referenced data: The Core Challenge</h3>
<p>After accounting for environmental covariates, you often have residual spatial structure:</p>
<p><span class="math display">\[y(\mathbf{s}) = \mathbf{X}(\mathbf{s})\boldsymbol{\beta} + w(\mathbf{s}) + \epsilon(\mathbf{s})\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(y(\mathbf{s})\)</span> = response at location <span class="math inline">\(\mathbf{s}\)</span></li>
<li><span class="math inline">\(\mathbf{X}(\mathbf{s})\boldsymbol{\beta}\)</span> = fixed effects (environmental covariates)</li>
<li><span class="math inline">\(w(\mathbf{s})\)</span> = <strong>spatial random effect</strong> (what we need to model!)</li>
<li><span class="math inline">\(\epsilon(\mathbf{s})\)</span> = non-spatial noise</li>
</ul>
<hr>
</section>
<section id="point-referenced-data-five-approaches" class="level3">
<h3 class="anchored" data-anchor-id="point-referenced-data-five-approaches">Point-Referenced data: Five Approaches</h3>
<p>We‚Äôll cover five main approaches, organized by their relationship to Gaussian Processes:</p>
<ol type="1">
<li><strong>Full Gaussian Processes (GPs)</strong> - theoretical <em>gold standard</em></li>
<li><strong>SPDE Approximation</strong> - Exact GPs using basis functions</li>
<li><strong>Low-Rank Gaussian Processes</strong> - Approximate GPs for efficiency</li>
<li><strong>Nearest Neighbor GPs</strong> - Local GP approximations</li>
<li><strong>Spatial Splines</strong> - Alternative smoothing framework (non-GP)</li>
</ol>
<p>Each represents different trade-offs between accuracy, computation, and flexibility.</p>
<hr>
</section>
<section id="understanding-the-gp-family-tree" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-gp-family-tree">Understanding the GP Family Tree</h3>
<section id="conceptual-relationships" class="level4">
<h4 class="anchored" data-anchor-id="conceptual-relationships">Conceptual Relationships</h4>
<p><strong>Full GP</strong> (<span class="math inline">\(O(n^3)\)</span>)</p>
<ul>
<li>Exact, but computationally prohibitive for large <span class="math inline">\(n\)</span></li>
</ul>
<p><strong>Reduced-Rank GP Approximations:</strong></p>
<ul>
<li><strong>SPDE</strong> - Exact Mat√©rn GP via finite elements (sparse matrices)<br>
</li>
<li><strong>Low-Rank GP</strong> - Approximate using subset of basis functions<br>
</li>
<li><strong>Nearest Neighbor GP</strong> - Local conditioning on nearby points</li>
</ul>
<p><strong>Alternative Framework:</strong></p>
<ul>
<li><strong>Splines</strong> - Smoothness penalty instead of covariance structure</li>
</ul>
<p><strong>Key insight:</strong> Methods 2-4 are all ways to make GPs computationally feasible while maintaining the probabilistic framework.</p>
<hr>
</section>
</section>
<section id="method-1-full-gaussian-processes" class="level3">
<h3 class="anchored" data-anchor-id="method-1-full-gaussian-processes">Method 1: Full Gaussian Processes</h3>
<p><strong>The gold standard for point-referenced data</strong></p>
<p><span class="math display">\[w(\mathbf{s}) \sim \mathcal{GP}(0, k(\mathbf{s}, \mathbf{s}'))\]</span></p>
<p><strong>Covariance function</strong> defines spatial correlation:</p>
<p><span class="math display">\[k(\mathbf{s}, \mathbf{s}') = \sigma^2 \exp\left(-\frac{||\mathbf{s} - \mathbf{s}'||^2}{2\ell^2}\right)\]</span></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><span class="math inline">\(\sigma^2\)</span> = spatial variance (how much spatial variation?)<br>
</li>
<li><span class="math inline">\(\ell\)</span> = length-scale (how far does correlation extend?)</li>
</ul>
<hr>
<section id="full-gp-covariance-functions" class="level4">
<h4 class="anchored" data-anchor-id="full-gp-covariance-functions">Full GP: Covariance Functions</h4>
<p><strong>Mat√©rn family</strong> (most common in ecology):</p>
<p><span class="math display">\[k(d) = \sigma^2 \frac{2^{1-\nu}}{\Gamma(\nu)}\left(\sqrt{2\nu}\frac{d}{\ell}\right)^\nu K_\nu\left(\sqrt{2\nu}\frac{d}{\ell}\right)\]</span></p>
<p><strong>Special cases:</strong></p>
<ul>
<li><span class="math inline">\(\nu = 0.5\)</span> ‚Üí <strong>Exponential</strong> (rough surfaces)</li>
<li><span class="math inline">\(\nu = 1.5\)</span> ‚Üí Once differentiable (good default)</li>
<li><span class="math inline">\(\nu = 2.5\)</span> ‚Üí Twice differentiable<br>
</li>
<li><span class="math inline">\(\nu \to \infty\)</span> ‚Üí <strong>Squared exponential</strong> (infinitely smooth)</li>
</ul>
</section>
</section>
</section>
<section id="practical-advice" class="level2">
<h2 class="anchored" data-anchor-id="practical-advice">Practical Advice</h2>
<p>Start with <span class="math inline">\(\nu = 1.5\)</span> (good default) or estimate it if you have enough data.</p>
<hr>
<section id="full-gp-the-computational-problem" class="level5">
<h5 class="anchored" data-anchor-id="full-gp-the-computational-problem">Full GP: The Computational Problem</h5>
<p><strong>Standard GP inference requires:</strong></p>
<ul>
<li>Inverting an <span class="math inline">\(n \times n\)</span> covariance matrix: <span class="math inline">\(O(n^3)\)</span> operations</li>
<li>Storing the matrix: <span class="math inline">\(O(n^2)\)</span> memory</li>
</ul>
<p><strong>Practical limits:</strong></p>
<ul>
<li>~1,000 locations: comfortable</li>
<li>~5,000 locations: challenging</li>
<li>10,000+ locations: infeasible</li>
</ul>
</section>
<section id="this-is-why-we-need-approximations" class="level4">
<h4 class="anchored" data-anchor-id="this-is-why-we-need-approximations">This is why we need approximations!</h4>
<p>Reduced rank GPs make modeling feasible for realistic ecological datasets.</p>
<hr>
</section>
<section id="full-gp-r-implementation" class="level4">
<h4 class="anchored" data-anchor-id="full-gp-r-implementation">Full GP: R Implementation</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fields)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Using geoR for ML estimation</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>geo_data <span class="ot">&lt;-</span> <span class="fu">as.geodata</span>(data, <span class="at">coords.col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">data.col =</span> <span class="dv">3</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit variogram</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>vario <span class="ot">&lt;-</span> <span class="fu">variog</span>(geo_data, <span class="at">max.dist =</span> <span class="dv">100</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vario)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Mat√©rn model</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>fit_ml <span class="ot">&lt;-</span> <span class="fu">likfit</span>(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  geo_data,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ini.cov.pars =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>),  <span class="co"># Initial sigma^2, range</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model =</span> <span class="st">"matern"</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">kappa =</span> <span class="fl">1.5</span>,              <span class="co"># nu parameter</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix.kappa =</span> <span class="cn">TRUE</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ml)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Kriging predictions</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>pred_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>x), <span class="fu">max</span>(data<span class="sc">$</span>x), <span class="at">length =</span> <span class="dv">50</span>),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>y), <span class="fu">max</span>(data<span class="sc">$</span>y), <span class="at">length =</span> <span class="dv">50</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>kc <span class="ot">&lt;-</span> <span class="fu">krige.control</span>(</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">type.krige =</span> <span class="st">"OK"</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">obj.model =</span> fit_ml</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">krige.conv</span>(</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  geo_data,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">locations =</span> pred_grid,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">krige =</span> kc</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot predictions</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="fu">image.plot</span>(predictions<span class="sc">$</span>predict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="method-2-spde-approximation" class="level3">
<h3 class="anchored" data-anchor-id="method-2-spde-approximation">Method 2: SPDE Approximation</h3>
<p><strong>The SPDE approach</strong> (Lindgren et al.&nbsp;2011) makes GPs computationally tractable!</p>
<p><strong>Key insight:</strong> A Mat√©rn GP is the solution to a <em>stochastic partial differential equation</em>:</p>
<p><span class="math display">\[(\kappa^2 - \Delta)^{\alpha/2}(\tau w(\mathbf{s})) = \mathcal{W}(\mathbf{s})\]</span></p>
<p><strong>Critical distinction:</strong> SPDE provides an <strong>exact</strong> representation of the Mat√©rn GP, not an approximation.</p>
<p><strong>Practical result:</strong></p>
<ul>
<li>Represent continuous GP using finite element basis functions<br>
</li>
<li>Sparse precision matrices enable fast computation<br>
</li>
<li>Reduces <span class="math inline">\(O(n^3)\)</span> to approximately <span class="math inline">\(O(n^{3/2})\)</span> or better<br>
</li>
<li>Makes analysis of 10,000+ locations feasible</li>
</ul>
<hr>
<section id="spde-how-it-works" class="level4">
<h4 class="anchored" data-anchor-id="spde-how-it-works">SPDE: How It Works</h4>
<ol type="1">
<li>Create triangular mesh over study area</li>
<li>GP represented exactly at mesh vertices</li>
<li>Values between vertices interpolated</li>
</ol>
<p><strong>Mesh construction is critical:</strong></p>
<ul>
<li>Finer mesh = better approximation<br>
</li>
<li>Coarser mesh = faster computation<br>
</li>
<li>Balance accuracy and speed<br>
</li>
<li>Extend mesh beyond study area</li>
</ul>
<p><strong>Rule of Thumb:</strong> Mesh resolution should be finer than the spatial range (<span class="math inline">\(\ell\)</span>), ideally &lt;1k <img src="images/mesh.jpeg" class="img-fluid" style="width:100.0%"></p>
<hr>
</section>
<section id="spde-r-implementation-with-sdmtmb" class="level4">
<h4 class="anchored" data-anchor-id="spde-r-implementation-with-sdmtmb">SPDE: R Implementation with <code>sdmTMB</code></h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sdmTMB)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create mesh object that contains matrices to apply the SPDE approach</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>mesh <span class="ot">&lt;-</span> <span class="fu">make_mesh</span>(pcod, <span class="at">xy_cols =</span> <span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>), <span class="at">cutoff =</span> <span class="dv">10</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a spatial model with a smoother for depth:</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">sdmTMB</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  density <span class="sc">~</span> <span class="fu">s</span>(depth),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pcod,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">mesh =</span> mesh,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">tweedie</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">spatial =</span> <span class="st">"on"</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Run some basic sanity checks on our model:</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sanity</span>(fit)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the ggeffects package to plot the smoother effect:</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>ggeffects<span class="sc">::</span><span class="fu">ggpredict</span>(fit, <span class="st">"depth [50:400, by=2]"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">plot</span>()</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain spatial predictions: </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> qcs_grid)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Map predictions </span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p, <span class="fu">aes</span>(X, Y, <span class="at">fill =</span> <span class="fu">exp</span>(est))) <span class="sc">+</span> <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">trans =</span> <span class="st">"sqrt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="spde-r-implementation-with-inla" class="level4">
<h4 class="anchored" data-anchor-id="spde-r-implementation-with-inla">SPDE: R Implementation with <code>INLA</code></h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(INLA)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(inlabru)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create mesh over study region</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>mesh <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">loc =</span> <span class="fu">cbind</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y),  <span class="co"># Data locations</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>),           <span class="co"># Inner and outer max edge</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">1</span>,                    <span class="co"># Min distance between mesh nodes</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">30</span>)             <span class="co"># Inner and outer extension</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize mesh</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mesh)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define SPDE model (Mat√©rn with alpha=2 gives nu=1)</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>spde <span class="ot">&lt;-</span> <span class="fu">inla.spde2.matern</span>(</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">mesh =</span> mesh, </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">2</span>  <span class="co"># alpha = nu + d/2, where d=2 (spatial dimensions)</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create projection matrix (links data locations to mesh)</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.A</span>(</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">mesh =</span> mesh,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">loc =</span> <span class="fu">cbind</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack data for INLA</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>stack <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> data<span class="sc">$</span>abundance),</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">list</span>(A, <span class="dv">1</span>),</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">effects =</span> <span class="fu">list</span>(</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">spatial =</span> <span class="dv">1</span><span class="sc">:</span>spde<span class="sc">$</span>n.spde,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> <span class="dv">1</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">elevation =</span> data<span class="sc">$</span>elevation,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">forest_cover =</span> data<span class="sc">$</span>forest_cover</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> elevation <span class="sc">+</span> forest_cover <span class="sc">+</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(spatial, <span class="at">model =</span> spde)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">inla</span>(</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  formula,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span>,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stack),</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.predictor =</span> <span class="fu">list</span>(</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">A =</span> <span class="fu">inla.stack.A</span>(stack),</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">compute =</span> <span class="cn">TRUE</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.compute =</span> <span class="fu">list</span>(</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">cpo =</span> <span class="cn">TRUE</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract spatial field estimates</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>spde_result <span class="ot">&lt;-</span> <span class="fu">inla.spde2.result</span>(result, <span class="st">"spatial"</span>, spde)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="spde-making-predictions" class="level4">
<h4 class="anchored" data-anchor-id="spde-making-predictions">SPDE: Making Predictions</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction grid</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pred_coords <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>x), <span class="fu">max</span>(data<span class="sc">$</span>x), <span class="at">length =</span> <span class="dv">100</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>y), <span class="fu">max</span>(data<span class="sc">$</span>y), <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Projection matrix for predictions</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>A_pred <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.A</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">mesh =</span> mesh,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">loc =</span> <span class="fu">as.matrix</span>(pred_coords)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction stack</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>stack_pred <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="cn">NA</span>),  <span class="co"># NA for prediction</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">list</span>(A_pred, <span class="dv">1</span>),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">effects =</span> <span class="fu">list</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">spatial =</span> <span class="dv">1</span><span class="sc">:</span>spde<span class="sc">$</span>n.spde,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> <span class="dv">1</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">elevation =</span> <span class="fu">mean</span>(data<span class="sc">$</span>elevation),</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">forest_cover =</span> <span class="fu">mean</span>(data<span class="sc">$</span>forest_cover)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with original data</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>stack_full <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(stack, stack_pred)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Refit model with prediction stack</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>result_pred <span class="ot">&lt;-</span> <span class="fu">inla</span>(</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  formula,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stack_full),</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.predictor =</span> <span class="fu">list</span>(</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">A =</span> <span class="fu">inla.stack.A</span>(stack_full),</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">compute =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">link =</span> <span class="dv">1</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>idx_pred <span class="ot">&lt;-</span> <span class="fu">inla.stack.index</span>(stack_full, <span class="st">"stack_pred"</span>)<span class="sc">$</span>data</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>pred_coords<span class="sc">$</span>mean <span class="ot">&lt;-</span> result_pred<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean[idx_pred]</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>pred_coords<span class="sc">$</span>sd <span class="ot">&lt;-</span> result_pred<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>sd[idx_pred]</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Map predictions</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred_coords, <span class="fu">aes</span>(x, y, <span class="at">fill =</span> mean)) <span class="sc">+</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="method-3-low-rank-gaussian-processes" class="level3">
<h3 class="anchored" data-anchor-id="method-3-low-rank-gaussian-processes">Method 3: Low-Rank Gaussian Processes</h3>
<p><strong>Reduced-rank GP approximations</strong> for computational efficiency</p>
<p><strong>Key idea:</strong> Approximate the spatial field using a smaller set of basis functions:</p>
<p><span class="math display">\[w(\mathbf{s}) \approx \sum_{j=1}^{m} \beta_j \phi_j(\mathbf{s})\]</span></p>
<p>Where <span class="math inline">\(m &lt;&lt; n\)</span> (number of basis functions much less than data points).</p>
<p><strong>Common approaches:</strong></p>
<ul>
<li><strong>Predictive Processes</strong> - GPs at knot locations</li>
<li><strong>Subset of Regressors</strong> - GP conditioning on subset</li>
<li><strong>Fixed Rank Kriging</strong> - Low-rank spatial covariance</li>
</ul>
<hr>
</section>
<section id="low-rank-gp-predictive-processes" class="level3">
<h3 class="anchored" data-anchor-id="low-rank-gp-predictive-processes">Low-Rank GP: Predictive Processes</h3>
<p><strong>Concept:</strong></p>
<ol type="1">
<li>Choose <span class="math inline">\(m\)</span> knot locations (e.g., 50-200 knots)</li>
<li>Define full GP at knots</li>
<li>Predict data locations as function of knot GPs</li>
</ol>
<p><span class="math display">\[w(\mathbf{s}) \approx \mathbf{C}(\mathbf{s}, \mathbf{s}^*) \mathbf{C}(\mathbf{s}^*, \mathbf{s}^*)^{-1} w(\mathbf{s}^*)\]</span></p>
<p>Where <span class="math inline">\(\mathbf{s}^*\)</span> are knot locations.</p>
<p><strong>Computational cost:</strong> <span class="math inline">\(O(nm^2 + m^3)\)</span> - dominated by <span class="math inline">\(m^3\)</span> for reasonable <span class="math inline">\(n\)</span></p>
<p><strong>Choosing m</strong> More knots = better approximation but slower. Start with <span class="math inline">\(m = \sqrt{n}\)</span> or 50-100 knots.</p>
<hr>
<section id="low-rank-gp-r-implementation" class="level4">
<h4 class="anchored" data-anchor-id="low-rank-gp-r-implementation">Low-Rank GP: R Implementation</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spBayes)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MBA)  <span class="co"># For knot placement</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define knots (can be data locations or regular grid)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>n_knots <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create regular grid of knots</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>knot_coords <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>x), <span class="fu">max</span>(data<span class="sc">$</span>x), <span class="at">length =</span> <span class="fu">sqrt</span>(n_knots)),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>y), <span class="fu">max</span>(data<span class="sc">$</span>y), <span class="at">length =</span> <span class="fu">sqrt</span>(n_knots))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, use k-means clustering for adaptive knots</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># kmeans_result &lt;- kmeans(cbind(data$x, data$y), centers = n_knots)</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># knot_coords &lt;- kmeans_result$centers</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for spBayes</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> elevation <span class="sc">+</span> forest_cover, <span class="at">data =</span> data)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> data<span class="sc">$</span>abundance</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up predictive process model</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>starting <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"phi"</span> <span class="ot">=</span> <span class="dv">3</span><span class="sc">/</span><span class="fu">max</span>(<span class="fu">dist</span>(coords)),  <span class="co"># 3/max_distance rule of thumb</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma.sq"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tau.sq"</span> <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>tuning <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"phi"</span> <span class="ot">=</span> <span class="fl">0.1</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma.sq"</span> <span class="ot">=</span> <span class="fl">0.1</span>,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tau.sq"</span> <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"beta.Flat"</span>,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"phi.Unif"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">/</span><span class="fu">max</span>(<span class="fu">dist</span>(coords)), <span class="dv">3</span><span class="sc">/</span><span class="fu">min</span>(<span class="fu">dist</span>(coords))),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma.sq.IG"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tau.sq.IG"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.1</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit predictive process model</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>pp_model <span class="ot">&lt;-</span> <span class="fu">spLM</span>(</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> X <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="fu">as.matrix</span>(knot_coords),</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">starting =</span> starting,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuning =</span> tuning,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">priors =</span> priors,</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model =</span> <span class="st">"exponential"</span>,</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.samples =</span> n_samples,</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.report =</span> <span class="dv">500</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Burn-in and thin</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>burn_in <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> n_samples</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>pp_samples <span class="ot">&lt;-</span> <span class="fu">spRecover</span>(</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  pp_model,</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> burn_in,</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">2</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pp_samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="low-rank-gp-alternative-with-frk" class="level4">
<h4 class="anchored" data-anchor-id="low-rank-gp-alternative-with-frk">Low-Rank GP: Alternative with <code>FRK</code></h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FRK)  <span class="co"># Fixed Rank Kriging</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create basis functions (2 resolutions)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>basis <span class="ot">&lt;-</span> <span class="fu">auto_basis</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> data<span class="sc">$</span>x, <span class="at">y =</span> data<span class="sc">$</span>y),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nres =</span> <span class="dv">2</span>,           <span class="co"># Number of resolutions</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"bisquare"</span>   <span class="co"># Basis function type</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>sp_data <span class="ot">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">cbind</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y),</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> data<span class="sc">$</span>abundance,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">elevation =</span> data<span class="sc">$</span>elevation,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">forest_cover =</span> data<span class="sc">$</span>forest_cover</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit FRK model</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>frk_model <span class="ot">&lt;-</span> <span class="fu">FRK</span>(</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">f =</span> z <span class="sc">~</span> elevation <span class="sc">+</span> forest_cover,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(sp_data),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">basis =</span> basis,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> <span class="st">"poisson"</span>  <span class="co"># Or "gaussian" for continuous</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>pred_grid <span class="ot">&lt;-</span> <span class="fu">SpatialPoints</span>(</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">cbind</span>(pred_coords<span class="sc">$</span>x, pred_coords<span class="sc">$</span>y)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(frk_model, <span class="at">newdata =</span> pred_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="method-4-nearest-neighbor-gaussian-processes" class="level3">
<h3 class="anchored" data-anchor-id="method-4-nearest-neighbor-gaussian-processes">Method 4: Nearest Neighbor Gaussian Processes</h3>
<p><strong>For very large datasets</strong> (&gt;10,000 points)</p>
<p><strong>Key idea:</strong> Each location conditions only on its <span class="math inline">\(m\)</span> nearest neighbors (typically <span class="math inline">\(m = 10-30\)</span>)</p>
<p><span class="math display">\[w(\mathbf{s}_i) | \{w(\mathbf{s}_j): j \in \mathcal{N}_m(i)\} \sim \text{Normal}(\boldsymbol{\mu}_i, \sigma^2_i)\]</span></p>
<p><strong>Advantages:</strong></p>
<ul>
<li>Scales to massive datasets (100,000+ locations)<br>
</li>
<li>Maintains proper GP framework<br>
</li>
<li>Computationally efficient: <span class="math inline">\(O(nm^3)\)</span><br>
</li>
<li>Can be highly accurate</li>
</ul>
<p><strong>Key development:</strong> Datta et al.&nbsp;(2016) - Nearest Neighbor Gaussian Process</p>
<hr>
<section id="nearest-neighbor-gp-how-it-works" class="level4">
<h4 class="anchored" data-anchor-id="nearest-neighbor-gp-how-it-works">Nearest Neighbor GP: How It Works</h4>
<p><strong>Response model:</strong> Define ordered observations <span class="math inline">\(\mathbf{y} = (y_1, \ldots, y_n)\)</span></p>
<p><strong>Neighbor set:</strong> For each <span class="math inline">\(i\)</span>, define <span class="math inline">\(\mathcal{N}_m(i)\)</span> = indices of <span class="math inline">\(m\)</span> nearest neighbors (prior to <span class="math inline">\(i\)</span>)</p>
<p><strong>Conditional specification:</strong></p>
<p><span class="math display">\[p(w_i | w_1, \ldots, w_{i-1}) = p(w_i | w_{\mathcal{N}_m(i)})\]</span></p>
<p><strong>Result:</strong> Sparse precision matrix, fast computation</p>
<section id="the-ordering-of-your-data-affects-results" class="level5">
<h5 class="anchored" data-anchor-id="the-ordering-of-your-data-affects-results">The ordering of your data affects results!</h5>
<p>Common factors to order by:</p>
<ul>
<li>by coordinate<br>
</li>
<li>space-filling curves<br>
</li>
<li>random</li>
</ul>
<hr>
</section>
</section>
<section id="nearest-neighbor-gp-r-package-spnngp" class="level4">
<h4 class="anchored" data-anchor-id="nearest-neighbor-gp-r-package-spnngp">Nearest Neighbor GP: R package <code>spNNGP</code></h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spNNGP)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> elevation <span class="sc">+</span> forest_cover, <span class="at">data =</span> data)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> data<span class="sc">$</span>abundance</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up NNGP model</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>n_neighbors <span class="ot">&lt;-</span> <span class="dv">15</span>  <span class="co"># Typical range: 10-30</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting values</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>starting <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"phi"</span> <span class="ot">=</span> <span class="dv">3</span><span class="sc">/</span><span class="fu">max</span>(<span class="fu">dist</span>(coords)),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma.sq"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tau.sq"</span> <span class="ot">=</span> <span class="fl">0.1</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"beta"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(X))</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Tuning parameters</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>tuning <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"phi"</span> <span class="ot">=</span> <span class="fl">0.5</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma.sq"</span> <span class="ot">=</span> <span class="fl">0.1</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tau.sq"</span> <span class="ot">=</span> <span class="fl">0.1</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"beta"</span> <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior distributions</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"beta.Flat"</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"phi.Unif"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">/</span><span class="fu">max</span>(<span class="fu">dist</span>(coords)), <span class="dv">3</span><span class="sc">/</span><span class="fl">0.01</span>),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma.sq.IG"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tau.sq.IG"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.1</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit NNGP model</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>nngp_model <span class="ot">&lt;-</span> <span class="fu">spNNGP</span>(</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> y <span class="sc">~</span> X <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords,</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">starting =</span> starting,</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"response"</span>,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.neighbors =</span> n_neighbors,</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuning =</span> tuning,</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">priors =</span> priors,</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov.model =</span> <span class="st">"exponential"</span>,</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.samples =</span> <span class="dv">5000</span>,</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.omp.threads =</span> <span class="dv">4</span>,  <span class="co"># Parallel threads</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior summaries</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nngp_model<span class="sc">$</span>p.beta.samples)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nngp_model<span class="sc">$</span>p.theta.samples)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions at new locations</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>pred_coords_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pred_coords[, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>X_pred <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(data<span class="sc">$</span>elevation),</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(data<span class="sc">$</span>forest_cover)</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  nngp_model,</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">X.0 =</span> X_pred,</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords.0 =</span> pred_coords_mat,</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.omp.threads =</span> <span class="dv">4</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract mean predictions</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>pred_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(predictions<span class="sc">$</span>p.y<span class="fl">.0</span>, <span class="dv">1</span>, mean)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>pred_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(predictions<span class="sc">$</span>p.y<span class="fl">.0</span>, <span class="dv">1</span>, sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="nearest-neighbor-gp-r-package-spabundance" class="level4">
<h4 class="anchored" data-anchor-id="nearest-neighbor-gp-r-package-spabundance">Nearest Neighbor GP: R package <code>spAbundance</code></h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spAbundance)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Bayesian heirarchical distance sampling model</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">spDS</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># State process formula</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">abund.formula =</span> <span class="sc">~</span> forest <span class="sc">+</span> grass ,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Observation process formula</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">det.formula =</span> <span class="sc">~</span> day <span class="sc">+</span> <span class="fu">I</span>(day<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> wind,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model controls</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat.MODO, <span class="at">n.batch =</span> <span class="dv">800</span>, <span class="at">batch.length =</span> <span class="dv">25</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">accept.rate =</span> <span class="fl">0.43</span>, <span class="at">cov.model =</span> <span class="st">"exponential"</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">transect =</span> <span class="st">'point'</span>, <span class="at">det.func =</span> <span class="st">'halfnormal'</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">NNGP =</span> <span class="cn">TRUE</span>, <span class="at">n.neighbors =</span> <span class="dv">15</span>, <span class="at">n.burn =</span> <span class="dv">10000</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.thin =</span> <span class="dv">5</span>, <span class="at">n.chains =</span> <span class="dv">3</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior predictive check</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ppcAbund</span>(out, <span class="at">fit.stat =</span> <span class="st">'freeman-tukey'</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Model selection</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="fu">waicAbund</span>(out)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>out.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(out, predictors, coordinates, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="method-5-spatial-splines" class="level3">
<h3 class="anchored" data-anchor-id="method-5-spatial-splines">Method 5: Spatial Splines</h3>
<p><strong>Alternative framework:</strong> Not based on Gaussian Processes</p>
<p><strong>Key idea:</strong> Approximate spatial surface with smooth basis functions</p>
<p><span class="math display">\[w(\mathbf{s}) = \sum_{k=1}^{K} \beta_k \phi_k(\mathbf{s})\]</span></p>
<p><strong>Distinguishing features:</strong></p>
<ul>
<li>Minimize roughness penalty (not maximize likelihood of covariance)</li>
<li>Deterministic smoothing approach</li>
<li>Can have Bayesian interpretation (splines as random effects)</li>
<li>Very fast computation</li>
<li>Different uncertainty quantification</li>
</ul>
<hr>
<section id="spatial-splines-types" class="level5">
<h5 class="anchored" data-anchor-id="spatial-splines-types">Spatial Splines: Types</h5>
<p><strong>Thin plate splines</strong> - Optimal smoothness properties</p>
<p>Minimize: <span class="math display">\[\sum_{i=1}^n (y_i - f(\mathbf{s}_i))^2 + \lambda \int \int \left[\left(\frac{\partial^2 f}{\partial x^2}\right)^2 + 2\left(\frac{\partial^2 f}{\partial x \partial y}\right)^2 + \left(\frac{\partial^2 f}{\partial y^2}\right)^2\right] dx\,dy\]</span></p>
<p><strong>Tensor product splines</strong> - Product of 1D basis functions</p>
<p><strong>Radial basis functions</strong> - Distance-based kernels</p>
</section>
</section>
</section>
<section id="when-to-use-splines" class="level2">
<h2 class="anchored" data-anchor-id="when-to-use-splines">When to Use Splines</h2>
<p>Splines are excellent for quick exploratory analysis and when you dont need explicit covariance modeling.</p>
<hr>
<section id="spatial-splines-r-implementation-with-mgcv" class="level4">
<h4 class="anchored" data-anchor-id="spatial-splines-r-implementation-with-mgcv">Spatial Splines: R Implementation with mgcv</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic spatial smooth</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>model_basic <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  abundance <span class="sc">~</span> <span class="fu">s</span>(x, y, <span class="at">bs =</span> <span class="st">"tp"</span>, <span class="at">k =</span> <span class="dv">50</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"REML"</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># With covariates</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  abundance <span class="sc">~</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(elevation, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(forest_cover, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(x, y, <span class="at">bs =</span> <span class="st">"tp"</span>, <span class="at">k =</span> <span class="dv">100</span>),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"REML"</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Check model</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="fu">gam.check</span>(model_full)  <span class="co"># Check basis dimensions and residuals</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot effects</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_full, <span class="at">pages =</span> <span class="dv">1</span>, <span class="at">scheme =</span> <span class="dv">2</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial smooth only</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_full, <span class="at">select =</span> <span class="dv">3</span>, <span class="at">scheme =</span> <span class="dv">2</span>, <span class="at">asp =</span> <span class="dv">1</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>x), <span class="fu">max</span>(data<span class="sc">$</span>x), <span class="at">length =</span> <span class="dv">100</span>),</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>y), <span class="fu">max</span>(data<span class="sc">$</span>y), <span class="at">length =</span> <span class="dv">100</span>),</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">elevation =</span> <span class="fu">mean</span>(data<span class="sc">$</span>elevation),</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">forest_cover =</span> <span class="fu">mean</span>(data<span class="sc">$</span>forest_cover)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>pred_data<span class="sc">$</span>fit <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_full, pred_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>pred_data<span class="sc">$</span>se <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_full, pred_data, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>se.fit</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Map predictions</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred_data, <span class="fu">aes</span>(x, y, <span class="at">fill =</span> fit)) <span class="sc">+</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Predicted</span><span class="sc">\n</span><span class="st">Abundance"</span>) <span class="sc">+</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="spatial-splines-tensor-products" class="level4">
<h4 class="anchored" data-anchor-id="spatial-splines-tensor-products">Spatial Splines: Tensor Products</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tensor product of marginal smooths (useful for anisotropy)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>model_tensor <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  abundance <span class="sc">~</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(elevation) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">te</span>(x, y, <span class="at">k =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>)),  <span class="co"># Tensor product</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"REML"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Adaptive smooth (varying complexity)</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>model_adaptive <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  abundance <span class="sc">~</span> </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(elevation) <span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(x, y, <span class="at">bs =</span> <span class="st">"ad"</span>, <span class="at">k =</span> <span class="dv">100</span>),  <span class="co"># Adaptive smooth</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"REML"</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Soap film smooth (with boundary)</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Useful when study area has complex shape</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>boundary <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"study_boundary.shp"</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert boundary to appropriate format</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># (See mgcv::smooth.construct.so.smooth.spec for details)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="point-referenced-comprehensive-comparison" class="level4">
<h4 class="anchored" data-anchor-id="point-referenced-comprehensive-comparison">Point-Referenced: Comprehensive Comparison</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Framework</th>
<th>Complexity</th>
<th>Speed</th>
<th>n Limit</th>
<th>Uncertainty</th>
<th>Best Use Case</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Full GP</strong></td>
<td>GP</td>
<td><span class="math inline">\(O(n^3)\)</span></td>
<td>Slow</td>
<td>~1000</td>
<td>Exact</td>
<td>Small datasets, methodological work</td>
</tr>
<tr class="even">
<td><strong>SPDE</strong></td>
<td>GP (exact)</td>
<td><span class="math inline">\(O(n^{3/2})\)</span></td>
<td>Fast</td>
<td>~50,000</td>
<td>Exact</td>
<td>Medium-large datasets, Bayesian inference</td>
</tr>
<tr class="odd">
<td><strong>Low-Rank GP</strong></td>
<td>GP (approx)</td>
<td><span class="math inline">\(O(nm^2 + m^3)\)</span></td>
<td>Medium</td>
<td>~10,000</td>
<td>Bayesian</td>
<td>Moderate datasets, flexible</td>
</tr>
<tr class="even">
<td><strong>NN-GP</strong></td>
<td>GP (approx)</td>
<td><span class="math inline">\(O(nm^3)\)</span></td>
<td>Fast</td>
<td>100,000+</td>
<td>Bayesian</td>
<td>Very large datasets</td>
</tr>
<tr class="odd">
<td><strong>Splines</strong></td>
<td>Non-GP</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>Very Fast</td>
<td>50,000+</td>
<td>Frequentist</td>
<td>Quick analysis, exploration</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="key-r-packages" class="level4">
<h4 class="anchored" data-anchor-id="key-r-packages">Key R packages</h4>
<p><strong>Full GP:</strong> <code>gstat</code> (classical geostats) + <code>fields</code> (spatial random fields)</p>
<p><strong>SPDE:</strong></p>
<ul>
<li><code>INLA</code> + <code>inlabru</code> (highly customizable)<br>
</li>
<li><code>sdmTMB</code> (user friendly, single species) or <code>tinyVAST</code> (multi-species)</li>
</ul>
<p><strong>Low-Rank GP:</strong> <code>spBayes</code> or <code>nimble</code> (highly customizable Bayesian modeling)</p>
<p><strong>Nearest Neighbor GP:</strong></p>
<ul>
<li><code>spNNGP</code> - Nearest Neighbor Gaussian Processes<br>
</li>
<li><code>spAbundance</code> &amp; <code>spOccupancy</code> (Hierarchical Bayesian models)</li>
</ul>
<p><strong>Splines:</strong> <code>mgcv</code> (GAMs) or <code>mvgams</code> (Hierarchical Bayesian GAMs)</p>
<hr>
</section>
</section>
<section id="common-pitfalls-and-solutions" class="level2">
<h2 class="anchored" data-anchor-id="common-pitfalls-and-solutions">Common Pitfalls and Solutions</h2>
</section>
<section id="watch-out-for" class="level2">
<h2 class="anchored" data-anchor-id="watch-out-for">Watch Out For:</h2>
<p><strong>Over-smoothing:</strong></p>
<ul>
<li>Splines: Check <code>gam.check()</code> and increase <code>k</code> if needed<br>
</li>
<li>GPs: Ensure spatial range parameter is estimable</li>
</ul>
<p><strong>Under-smoothing:</strong></p>
<ul>
<li>Creates overly complex surfaces that don‚Äôt generalize<br>
</li>
<li>Use cross-validation to check predictive performance</li>
</ul>
<p><strong>Computational Issues:</strong></p>
<ul>
<li>Start with small datasets to test workflow<br>
</li>
<li>Use reduced-rank methods before attempting full GP<br>
</li>
<li>Consider parallelization for MCMC-based methods</li>
</ul>
<p><strong>Mesh/Knot Placement:</strong></p>
<ul>
<li>SPDE: Mesh should extend beyond data<br>
</li>
<li>Low-Rank: Try different knot configurations</li>
</ul>
<hr>
<section id="validation-and-model-checking" class="level4">
<h4 class="anchored" data-anchor-id="validation-and-model-checking">Validation and Model Checking</h4>
<p><strong>Essential diagnostics for all methods:</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Residual spatial autocorrelation</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>neighbors <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords, <span class="dv">0</span>, max_distance)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(neighbors)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(<span class="fu">residuals</span>(model), weights)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Variogram of residuals</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>resid_variogram <span class="ot">&lt;-</span> <span class="fu">variogram</span>(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  residuals <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">locations =</span> <span class="sc">~</span>x<span class="sc">+</span>y, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resid_variogram)  <span class="co"># Should be flat if spatial structure captured</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Spatial cross-validation</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(blockCV)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>spatial_blocks <span class="ot">&lt;-</span> <span class="fu">cv_spatial</span>(</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> data_sf,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">column =</span> <span class="st">"response"</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">5</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">10000</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Predictive performance</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare RMSE, MAE, coverage of prediction intervals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="integration-with-covariates" class="level4">
<h4 class="anchored" data-anchor-id="integration-with-covariates">Integration with Covariates</h4>
<p><strong>All methods can include environmental covariates:</strong></p>
<p><strong>Additive structure:</strong> <span class="math display">\[y(\mathbf{s}) = \beta_0 + \sum_{j=1}^p f_j(x_j(\mathbf{s})) + w(\mathbf{s}) + \epsilon(\mathbf{s})\]</span></p>
<p>Where <span class="math inline">\(f_j\)</span> can be: - Linear effects: <span class="math inline">\(\beta_j x_j\)</span> - Smooth effects: Spline or polynomial - Interactions: <span class="math inline">\(x_j \times x_k\)</span> or tensor products</p>
</section>
</section>
<section id="interpretation-challenge" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-challenge">Interpretation Challenge</h2>
<p>Spatial random effects can ‚Äúabsorb‚Äù covariate effects if covariates are spatially structured. Consider restricted spatial regression or spatial confounding adjustments.</p>
<hr>
</section>
<section id="advanced-topics" class="level2">
<h2 class="anchored" data-anchor-id="advanced-topics">Advanced Topics</h2>
<p><strong>Extensions of point-referenced methods:</strong></p>
<ul>
<li><strong>Non-stationary GPs</strong> - Spatial parameters vary across space</li>
<li><strong>Anisotropic models</strong> - Correlation depends on direction</li>
<li><strong>Space-time models</strong> - Add temporal dimension</li>
<li><strong>Multivariate spatial models</strong> - Multiple responses</li>
<li><strong>Preferential sampling</strong> - Locations not random</li>
<li><strong>Measurement error</strong> - Covariate uncertainty</li>
</ul>
<p><strong>These typically require specialized implementations of the core methods.</strong></p>
<hr>
<section id="summary-point-referenced-data" class="level4">
<h4 class="anchored" data-anchor-id="summary-point-referenced-data">Summary: Point-Referenced Data</h4>
<p><strong>Key Takeaways</strong></p>
<ol type="1">
<li><strong>Gaussian Processes</strong> provide the theoretical foundation</li>
<li><strong>SPDE</strong> offers exact GP representation with computational efficiency</li>
<li><strong>Low-Rank and NN-GP</strong> are approximations that scale to large datasets</li>
<li><strong>Splines</strong> provide a fast alternative framework</li>
<li><strong>Choice depends on:</strong> dataset size, computational resources, and inference goals</li>
<li><strong>Start simple</strong> (splines) and add complexity as needed</li>
<li><strong>Always validate</strong> using spatial cross-validation</li>
<li><strong>Check residuals</strong> for remaining spatial structure</li>
</ol>
<hr>
</section>
</section>
<section id="resources-and-further-reading" class="level2">
<h2 class="anchored" data-anchor-id="resources-and-further-reading">Resources and Further Reading</h2>
<p><strong>Key Papers:</strong></p>
<ul>
<li>Lindgren et al.&nbsp;(2011) ‚ÄúAn explicit link between Gaussian fields and GMRFs‚Äù <em>JRSS-B</em></li>
<li>Datta et al.&nbsp;(2016) ‚ÄúHierarchical Nearest-Neighbor Gaussian Process Models‚Äù <em>JASA</em></li>
<li>Banerjee et al.&nbsp;(2008) ‚ÄúGaussian predictive process models‚Äù <em>JRSS-B</em></li>
<li>Wood (2017) <em>Generalized Additive Models: An Introduction with R</em></li>
</ul>
<p><strong>Online Resources:</strong></p>
<ul>
<li><a href="https://www.r-inla.org/">R-INLA website</a> - Tutorials and examples</li>
<li><a href="https://cran.r-project.org/web/packages/mgcv/">mgcv documentation</a></li>
<li><a href="https://rspatial.org/">Spatial Data Science with R</a></li>
</ul>
<p><strong>Books:</strong></p>
<ul>
<li>Banerjee et al.&nbsp;(2014) <em>Hierarchical Modeling and Analysis for Spatial Data</em></li>
<li>Cressie &amp; Wikle (2011) <em>Statistics for Spatio-Temporal Data</em></li>
</ul>
<hr>
</section>
<section id="areal-lattice-data" class="level2">
<h2 class="anchored" data-anchor-id="areal-lattice-data">2. Areal / Lattice Data</h2>
<p><em>Aggregated data in discrete spatial units</em></p>
<section id="what-is-areal-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-areal-data">What is Areal Data?</h3>
<p><strong>Definition:</strong> Data aggregated to discrete spatial units with defined boundaries.</p>
<p><strong>Ecological Examples:</strong></p>
<ul>
<li>Species counts by county or grid cell</li>
<li>Disease prevalence by administrative unit</li>
<li>Land cover by hexagonal bins</li>
<li>Population density by watershed</li>
<li>Camera trap detections by site</li>
</ul>
<p><strong>Key characteristic:</strong> Space is <strong>partitioned</strong> into units; data are <strong>aggregated</strong> within units.</p>
<hr>
<section id="areal-data-visual-example" class="level4">
<h4 class="anchored" data-anchor-id="areal-data-visual-example">Areal Data: Visual Example</h4>
<p><img src="images/cloropleth.jpg" class="img-fluid" alt="County-level choropleth map">{width 50%}</p>
<p><strong>Typical scenario:</strong></p>
<ul>
<li>20-5000 spatial units (polygons or grid cells)<br>
</li>
<li>Clear neighborhood structure<br>
</li>
<li>Count or aggregated data per unit<br>
</li>
<li>Want to account for spatial dependence</li>
</ul>
</section>
</section>
</section>
<section id="common-questions" class="level2">
<h2 class="anchored" data-anchor-id="common-questions">Common Questions</h2>
<ul>
<li>Are neighboring units more similar?</li>
<li>How do I borrow strength across space?</li>
<li>Can I smooth noisy estimates?</li>
<li>Should I worry about edge effects?</li>
</ul>
<hr>
<section id="areal-data-neighborhood-structure" class="level4">
<h4 class="anchored" data-anchor-id="areal-data-neighborhood-structure">Areal Data: Neighborhood Structure</h4>
<p><strong>Critical concept:</strong> Who are my neighbors?</p>
<p><strong>Common definitions:</strong></p>
<ol type="1">
<li><strong>Rook adjacency</strong> - shared border</li>
<li><strong>Queen adjacency</strong> - shared border or corner</li>
<li><strong>Distance-based</strong> - within threshold distance</li>
<li><strong>k-nearest neighbors</strong> - k closest centroids</li>
</ol>
<p><strong>Adjacency Matrix</strong> Neighborhood structure encoded in matrix <span class="math inline">\(\mathbf{W}\)</span>: <span class="math display">\[w_{ij} = \begin{cases} 1 &amp; \text{if } i \text{ and } j \text{ are neighbors} \\ 0 &amp; \text{otherwise} \end{cases}\]</span></p>
<hr>
</section>
<section id="areal-data-method-1---car-models" class="level3">
<h3 class="anchored" data-anchor-id="areal-data-method-1---car-models">Areal Data: Method 1 - CAR Models</h3>
<p><strong>Conditional Autoregressive (CAR) Models</strong></p>
<p>Each area‚Äôs random effect depends on its neighbors:</p>
<p><span class="math display">\[w_i | \mathbf{w}_{-i}, \tau^2 \sim \text{Normal}\left(\sum_{j \sim i} b_{ij}w_j, \tau_i^2\right)\]</span></p>
<p><strong>Most common:</strong> Intrinsic CAR (ICAR)</p>
<p><span class="math display">\[w_i | \mathbf{w}_{-i}, \tau^2 \sim \text{Normal}\left(\frac{1}{n_i}\sum_{j \sim i} w_j, \frac{\tau^2}{n_i}\right)\]</span></p>
<p>Where <span class="math inline">\(n_i\)</span> = number of neighbors of area <span class="math inline">\(i\)</span>.</p>
<hr>
<section id="icar-model-properties" class="level5">
<h5 class="anchored" data-anchor-id="icar-model-properties">ICAR Model: Properties</h5>
<p><strong>Interpretation:</strong> Each area‚Äôs value is the average of its neighbors, plus noise.</p>
<p><strong>Key properties:</strong></p>
<ul>
<li>Induces <strong>strong</strong> spatial smoothing</li>
<li>Prior is <strong>improper</strong> (infinite variance)</li>
<li>Requires sum-to-zero constraint: <span class="math inline">\(\sum_i w_i = 0\)</span></li>
<li>Variance proportional to <span class="math inline">\(1/n_i\)</span> (islands have high variance!)</li>
</ul>
<p><strong>Island Problem</strong> Areas with few neighbors have high uncertainty. Consider removing islands or using proper CAR.</p>
<hr>
</section>
</section>
<section id="areal-data-method-2---proper-car" class="level3">
<h3 class="anchored" data-anchor-id="areal-data-method-2---proper-car">Areal Data: Method 2 - Proper CAR</h3>
<p><strong>Adds spatial decay parameter</strong> <span class="math inline">\(\rho\)</span> to control smoothing strength:</p>
<p><span class="math display">\[w_i | \mathbf{w}_{-i}, \tau^2, \rho \sim \text{Normal}\left(\frac{\rho}{n_i}\sum_{j \sim i} w_j, \frac{\tau^2}{n_i}\right)\]</span></p>
<p><strong>Properties:</strong></p>
<ul>
<li><span class="math inline">\(\rho = 0\)</span> ‚Üí independent random effects (no spatial structure)</li>
<li><span class="math inline">\(\rho \to 1\)</span> ‚Üí approaches ICAR (maximum smoothing)</li>
<li><strong>Proper</strong> prior (finite variance)</li>
<li>Can estimate <span class="math inline">\(\rho\)</span> from data</li>
</ul>
<p><strong>When to use:</strong> When you want data to determine smoothing strength.</p>
<hr>
</section>
<section id="areal-data-method-3---bym-model" class="level3">
<h3 class="anchored" data-anchor-id="areal-data-method-3---bym-model">Areal Data: Method 3 - BYM Model</h3>
<p><strong>Besag-York-Molli√© (BYM) Model</strong> - convolution of spatial and non-spatial effects:</p>
<p><span class="math display">\[w_i = u_i + v_i\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(u_i \sim \text{ICAR}(\tau_u^2)\)</span> ‚Üí spatially structured</li>
<li><span class="math inline">\(v_i \sim \text{Normal}(0, \tau_v^2)\)</span> ‚Üí unstructured</li>
</ul>
<p><strong>Advantage:</strong> Separates spatial and non-spatial variation</p>
<section id="bym2-parameterization" class="level4">
<h4 class="anchored" data-anchor-id="bym2-parameterization">BYM2 Parameterization</h4>
<p>Modern version uses a mixing parameter <span class="math inline">\(\phi \in [0,1]\)</span>: <span class="math display">\[w_i = \frac{1}{\sqrt{\tau}}(\sqrt{\phi} \cdot u_i + \sqrt{1-\phi} \cdot v_i)\]</span> Easier to specify priors!</p>
<hr>
</section>
</section>
<section id="areal-data-method-4---sar-models" class="level3">
<h3 class="anchored" data-anchor-id="areal-data-method-4---sar-models">Areal Data: Method 4 - SAR Models</h3>
<p><strong>Simultaneous Autoregressive (SAR) Models</strong></p>
<p>Different from CAR! Response depends on neighbors‚Äô <strong>responses</strong>:</p>
<p><span class="math display">\[\mathbf{y} = \rho \mathbf{W}\mathbf{y} + \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon}\]</span></p>
<p><strong>Key difference:</strong></p>
<ul>
<li>CAR: Spatial dependence in <strong>random effects</strong></li>
<li>SAR: Spatial dependence in <strong>response variable</strong> itself</li>
<li>SAR has ‚Äúspillover‚Äù effects (feedback loops)</li>
</ul>
<p><strong>Implementation:</strong> <code>spdep</code> package in R</p>
<hr>
<section id="areal-data-car-vs-sar" class="level4">
<h4 class="anchored" data-anchor-id="areal-data-car-vs-sar">Areal Data: CAR vs SAR</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Feature</th>
<th>CAR</th>
<th>SAR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>What‚Äôs spatial?</td>
<td>Random effects</td>
<td>Response variable</td>
</tr>
<tr class="even">
<td>Interpretation</td>
<td>Smoothing</td>
<td>Spillover/feedback</td>
</tr>
<tr class="odd">
<td>Computation</td>
<td>Easy (INLA)</td>
<td>More complex</td>
</tr>
<tr class="even">
<td>Bayesian</td>
<td>Yes</td>
<td>Possible but harder</td>
</tr>
<tr class="odd">
<td>Ecology use</td>
<td>Very common</td>
<td>Less common</td>
</tr>
</tbody>
</table>
<p><strong>In Practice</strong> CAR models are much more common in ecology. SAR models used more in econometrics.</p>
<hr>
</section>
</section>
<section id="areal-data-method-5---spatial-eigenvectors" class="level3">
<h3 class="anchored" data-anchor-id="areal-data-method-5---spatial-eigenvectors">Areal Data: Method 5 - Spatial Eigenvectors</h3>
<p><strong>Moran‚Äôs Eigenvector Maps (MEM) / PCNM</strong></p>
<p><strong>Idea:</strong> Decompose spatial relationships into orthogonal eigenvectors</p>
<ol type="1">
<li>Create distance/connectivity matrix</li>
<li>Eigendecompose to get spatial filters</li>
<li>Use eigenvectors as covariates in regression</li>
</ol>
<p><span class="math display">\[y_i = \beta_0 + \sum_{k=1}^K \beta_k \text{EV}_{ik} + \epsilon_i\]</span></p>
<p><strong>Advantages:</strong></p>
<ul>
<li>Works with any spatial configuration</li>
<li>Frequentist framework (familiar to many ecologists)</li>
<li>Can select eigenvectors (forward selection)</li>
</ul>
<hr>
<section id="spatial-eigenvectors-example" class="level4">
<h4 class="anchored" data-anchor-id="spatial-eigenvectors-example">Spatial Eigenvectors: Example</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adespatial)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighborhood structure</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(polygons))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(polygons)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate spatial eigenvectors</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>mem <span class="ot">&lt;-</span> <span class="fu">scores.listw</span>(<span class="fu">nb2listw</span>(nb), </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">wt =</span> coords,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">MEM.autocor =</span> <span class="st">"positive"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Use in regression</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(abundance <span class="sc">~</span> covariate1 <span class="sc">+</span> covariate2 <span class="sc">+</span> </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>            MEM1 <span class="sc">+</span> MEM2 <span class="sc">+</span> MEM3, <span class="at">data =</span> mydata)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Or select eigenvectors via forward selection</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>mem.sel <span class="ot">&lt;-</span> <span class="fu">forward.sel</span>(<span class="at">y =</span> mydata<span class="sc">$</span>abundance,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">x =</span> mem<span class="sc">$</span>vectors,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alpha =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="areal-data-comparison" class="level4">
<h4 class="anchored" data-anchor-id="areal-data-comparison">Areal Data: Comparison</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 24%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Framework</th>
<th>Smoothing</th>
<th>Flexibility</th>
<th>Best For</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ICAR</td>
<td>Bayesian</td>
<td>Strong</td>
<td>Low</td>
<td>Small n, strong spatial signal</td>
</tr>
<tr class="even">
<td>Proper CAR</td>
<td>Bayesian</td>
<td>Data-driven</td>
<td>Medium</td>
<td>Estimate smoothing strength</td>
</tr>
<tr class="odd">
<td>BYM/BYM2</td>
<td>Bayesian</td>
<td>Flexible</td>
<td>High</td>
<td>Separate spatial/non-spatial</td>
</tr>
<tr class="even">
<td>SAR</td>
<td>Frequentist</td>
<td>Feedback</td>
<td>Medium</td>
<td>Spillover processes</td>
</tr>
<tr class="odd">
<td>MEM</td>
<td>Frequentist</td>
<td>Data-driven</td>
<td>High</td>
<td>Flexible, frequentist</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="areal-data-r-example-with-inla" class="level4">
<h4 class="anchored" data-anchor-id="areal-data-r-example-with-inla">Areal Data: R Example with INLA</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(INLA)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load spatial data</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"regions.shp"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighborhood structure</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(regions)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">nb2INLA</span>(<span class="st">"region.adj"</span>, nb)  <span class="co"># Save adjacency for INLA</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">st_drop_geometry</span>(regions)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>region_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># BYM2 model</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> cases <span class="sc">~</span> </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  covariate1 <span class="sc">+</span> </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  covariate2 <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(region_id, </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">"bym2"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph =</span> <span class="st">"region.adj"</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper =</span> <span class="fu">list</span>(</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">prec =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">"pc.prec"</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.01</span>)),</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">phi =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">"pc"</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">inla</span>(</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  formula,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span>,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">E =</span> data<span class="sc">$</span>expected,  <span class="co"># For disease mapping</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>, <span class="at">waic =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract spatial random effects</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>spatial_effects <span class="ot">&lt;-</span> result<span class="sc">$</span>summary.random<span class="sc">$</span>region_id</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Map results</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>regions<span class="sc">$</span>fitted <span class="ot">&lt;-</span> result<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(regions[<span class="st">"fitted"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
</section>
<section id="point-pattern-data" class="level2">
<h2 class="anchored" data-anchor-id="point-pattern-data">3. Point Pattern Data</h2>
<p><em>When locations themselves are the response</em></p>
<hr>
<section id="what-is-point-pattern-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-point-pattern-data">What is Point Pattern Data?</h3>
<p><strong>Definition:</strong> The spatial locations of events/individuals are what we‚Äôre modeling.</p>
<p><strong>Ecological Examples:</strong></p>
<ul>
<li>Tree locations in a forest plot</li>
<li>Animal sightings/occurrences</li>
<li>Nest locations of colonial birds</li>
<li>Burrow entrances</li>
<li>Lightning strike locations</li>
</ul>
<p><strong>Key characteristic:</strong> The <strong>pattern of locations</strong> is the phenomenon of interest, not a measurement at those locations.</p>
<hr>
<section id="point-pattern-visual-example" class="level4">
<h4 class="anchored" data-anchor-id="point-pattern-visual-example">Point Pattern: Visual Example</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/62/Spatial_point_pattern.svg/440px-Spatial_point_pattern.svg.png" class="img-fluid figure-img"></p>
<figcaption>Spatial point pattern</figcaption>
</figure>
</div>
<p><strong>Key questions:</strong></p>
<ul>
<li>Random, clustered, or regular?</li>
<li>Does intensity vary across space?</li>
<li>What drives the spatial pattern?</li>
<li>Interaction between points?</li>
</ul>
<p><strong>Three Main Patterns</strong> - <em>Random</em> (CSR - Complete Spatial Randomness) - <em>Clustered</em> (aggregated, contagious) - <em>Regular</em> (dispersed, uniform, inhibition)</p>
<hr>
</section>
</section>
<section id="point-pattern-core-concept---intensity" class="level3">
<h3 class="anchored" data-anchor-id="point-pattern-core-concept---intensity">Point Pattern: Core Concept - Intensity</h3>
<p><strong>Intensity function</strong> <span class="math inline">\(\lambda(\mathbf{s})\)</span> = expected number of points per unit area at location <span class="math inline">\(\mathbf{s}\)</span></p>
<p><span class="math display">\[\mathbb{E}[N(A)] = \int_A \lambda(\mathbf{s}) d\mathbf{s}\]</span></p>
<p><strong>Types:</strong></p>
<ul>
<li><strong>Homogeneous:</strong> <span class="math inline">\(\lambda(\mathbf{s}) = \lambda\)</span> (constant)</li>
<li><strong>Inhomogeneous:</strong> <span class="math inline">\(\lambda(\mathbf{s})\)</span> varies with location</li>
<li><strong>Can depend on covariates:</strong> <span class="math inline">\(\lambda(\mathbf{s}) = \exp(\mathbf{X}(\mathbf{s})\boldsymbol{\beta})\)</span></li>
</ul>
<hr>
</section>
<section id="point-pattern-method-1---inhomogeneous-poisson-process" class="level3">
<h3 class="anchored" data-anchor-id="point-pattern-method-1---inhomogeneous-poisson-process">Point Pattern: Method 1 - Inhomogeneous Poisson Process</h3>
<p><strong>Simplest model:</strong> Points are independent given intensity function</p>
<p><span class="math display">\[\lambda(\mathbf{s}) = \exp(\beta_0 + \beta_1 x_1(\mathbf{s}) + ... + \beta_p x_p(\mathbf{s}))\]</span></p>
<p><strong>Fitting:</strong></p>
<ul>
<li>Divide study area into grid/quadrats</li>
<li>Count points per cell</li>
<li>Fit Poisson GLM or use <code>spatstat</code> for continuous intensity</li>
</ul>
<p><strong>Assumption</strong> Points are <strong>independent</strong> - no interaction or clustering beyond what covariates explain.</p>
<hr>
</section>
<section id="point-pattern-method-2---cox-processes" class="level3">
<h3 class="anchored" data-anchor-id="point-pattern-method-2---cox-processes">Point Pattern: Method 2 - Cox Processes</h3>
<p><strong>Adds spatial random effects to intensity:</strong></p>
<p><span class="math display">\[\lambda(\mathbf{s}) = \exp(\mathbf{X}(\mathbf{s})\boldsymbol{\beta} + w(\mathbf{s}))\]</span></p>
<p>Where <span class="math inline">\(w(\mathbf{s})\)</span> is a spatial Gaussian process.</p>
<p><strong>Types:</strong></p>
<ul>
<li><strong>Log-Gaussian Cox Process (LGCP)</strong> - GP on log-intensity</li>
<li><strong>Shot-noise Cox Process</strong> - clusters around random parent points</li>
</ul>
<p><strong>Result:</strong> Accounts for residual spatial clustering not explained by covariates.</p>
<hr>
<section id="lgcp-implementation-approaches" class="level4">
<h4 class="anchored" data-anchor-id="lgcp-implementation-approaches">LGCP: Implementation Approaches</h4>
<p><strong>Approach 1: Discretize space</strong></p>
<ul>
<li>Divide area into fine grid</li>
<li>Model counts per cell with spatial random effects</li>
<li>Use INLA with SPDE</li>
</ul>
<p><strong>Approach 2: Integrated nested Laplace approximation</strong></p>
<ul>
<li>Direct likelihood for point pattern</li>
<li>Continuous intensity surface</li>
<li>Package: <code>inlabru</code> in R</li>
</ul>
<hr>
</section>
</section>
<section id="point-pattern-method-3---interaction-models" class="level3">
<h3 class="anchored" data-anchor-id="point-pattern-method-3---interaction-models">Point Pattern: Method 3 - Interaction Models</h3>
<p><strong>For processes with point-to-point interaction:</strong></p>
<p><span class="math display">\[\lambda(\mathbf{s} | \text{other points}) = \lambda(\mathbf{s}) \times g(\text{distances to other points})\]</span></p>
<p><strong>Types:</strong></p>
<ul>
<li><strong>Hard-core:</strong> Minimum distance between points</li>
<li><strong>Strauss process:</strong> Inhibition within distance <span class="math inline">\(r\)</span></li>
<li><strong>Geyer saturation:</strong> Limited inhibition strength</li>
</ul>
<p><strong>Use when:</strong> Points repel or attract each other (territoriality, facilitation).</p>
<p>Package: <code>spatstat</code> in R for interaction models</p>
<hr>
<section id="point-pattern-comparison" class="level4">
<h4 class="anchored" data-anchor-id="point-pattern-comparison">Point Pattern: Comparison</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 18%">
<col style="width: 21%">
<col style="width: 24%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Model Type</th>
<th>Complexity</th>
<th>Interaction</th>
<th>Spatial Trend</th>
<th>Best For</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Poisson</td>
<td>Low</td>
<td>None</td>
<td>Yes (via covariates)</td>
<td>Independent points</td>
</tr>
<tr class="even">
<td>LGCP</td>
<td>Medium</td>
<td>Apparent (via GP)</td>
<td>Yes</td>
<td>Clustering from environment</td>
</tr>
<tr class="odd">
<td>Hard-core</td>
<td>Medium</td>
<td>Strong repulsion</td>
<td>Yes</td>
<td>Territorial species</td>
</tr>
<tr class="even">
<td>Strauss</td>
<td>High</td>
<td>Tunable</td>
<td>Yes</td>
<td>Flexible interaction</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="point-pattern-r-example-with-spatstat" class="level4">
<h4 class="anchored" data-anchor-id="point-pattern-r-example-with-spatstat">Point Pattern: R Example with spatstat</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create point pattern object</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> trees<span class="sc">$</span>x, <span class="at">y =</span> trees<span class="sc">$</span>y,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">window =</span> <span class="fu">owin</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for complete spatial randomness</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">envelope</span>(pp, Kest))  <span class="co"># K-function envelope test</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit inhomogeneous Poisson with covariates</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create spatial covariates</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>elevation_im <span class="ot">&lt;-</span> <span class="fu">as.im</span>(elevation_raster)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>fit_pois <span class="ot">&lt;-</span> <span class="fu">ppm</span>(pp <span class="sc">~</span> elevation <span class="sc">+</span> <span class="fu">I</span>(elevation<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">covariates =</span> <span class="fu">list</span>(<span class="at">elevation =</span> elevation_im))</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit log-Gaussian Cox process</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>fit_lgcp <span class="ot">&lt;-</span> <span class="fu">kppm</span>(pp <span class="sc">~</span> elevation,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">clusters =</span> <span class="st">"LGCP"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">covariates =</span> <span class="fu">list</span>(<span class="at">elevation =</span> elevation_im))</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare models</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit_pois)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit_lgcp)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict intensity</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>pred_intensity <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_lgcp)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_intensity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="point-pattern-r-example-with-inlabru" class="level4">
<h4 class="anchored" data-anchor-id="point-pattern-r-example-with-inlabru">Point Pattern: R Example with inlabru</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(inlabru)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(INLA)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> <span class="fu">SpatialPoints</span>(<span class="fu">cbind</span>(trees<span class="sc">$</span>x, trees<span class="sc">$</span>y))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>boundary <span class="ot">&lt;-</span> <span class="fu">SpatialPolygons</span>(<span class="fu">list</span>(<span class="fu">Polygons</span>(<span class="fu">list</span>(<span class="fu">Polygon</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">100</span>,<span class="dv">0</span>, <span class="dv">100</span>,<span class="dv">100</span>, <span class="dv">0</span>,<span class="dv">100</span>, <span class="dv">0</span>,<span class="dv">0</span>), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>)), <span class="st">"boundary"</span>)))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create mesh</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>mesh <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">boundary =</span> boundary,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">2</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Define LGCP model with covariates</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>cmp <span class="ot">&lt;-</span> coordinates <span class="sc">~</span> </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Intercept</span>(<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">elevation</span>(elevation_data, <span class="at">model =</span> <span class="st">"linear"</span>) <span class="sc">+</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spatial</span>(coordinates, </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">model =</span> <span class="fu">inla.spde2.matern</span>(mesh))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lgcp</span>(</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  cmp,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> points,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">domain =</span> <span class="fu">list</span>(<span class="at">coordinates =</span> mesh),</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">control.inla =</span> <span class="fu">list</span>(<span class="at">int.strategy =</span> <span class="st">"eb"</span>))</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict intensity surface</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>pred_coords <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">length =</span> <span class="dv">100</span>),</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  pred_coords,</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">exp</span>(Intercept <span class="sc">+</span> elevation <span class="sc">+</span> spatial)</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
</section>
<section id="movement-trajectory-data" class="level2">
<h2 class="anchored" data-anchor-id="movement-trajectory-data">3. Movement / Trajectory Data</h2>
<p><em>GPS tracks, telemetry, and animal paths</em></p>
<hr>
<section id="what-is-movement-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-movement-data">What is Movement Data?</h3>
<p><strong>Definition:</strong> Locations of individuals tracked through time, creating paths or trajectories.</p>
<p><strong>Ecological Examples:</strong></p>
<ul>
<li>GPS collars on mammals</li>
<li>Bird migration tracks</li>
<li>Fish acoustic telemetry</li>
<li>Insect flight paths</li>
<li>Marine turtle tracking</li>
</ul>
<p><strong>Key characteristic:</strong> Data have <strong>temporal</strong> and <strong>spatial</strong> structure; autocorrelation in both dimensions.</p>
<hr>
<section id="movement-data-visual-example" class="level4">
<h4 class="anchored" data-anchor-id="movement-data-visual-example">Movement Data: Visual Example</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f5/Animal_track_-_GPS_collar.svg/500px-Animal_track_-_GPS_collar.svg.png" class="img-fluid figure-img"></p>
<figcaption>Animal movement track</figcaption>
</figure>
</div>
<p><strong>Typical data structure:</strong></p>
<ul>
<li>Individual ID</li>
<li>Timestamp</li>
<li>Longitude, Latitude</li>
<li>Environmental covariates</li>
<li>Behavioral state (sometimes)</li>
</ul>
</section>
</section>
</section>
<section id="key-questions" class="level2">
<h2 class="anchored" data-anchor-id="key-questions">Key Questions</h2>
<ul>
<li>What drives movement decisions?</li>
<li>How do animals select habitat?</li>
<li>Can we identify behavioral states?</li>
<li>What‚Äôs the home range?</li>
<li>How do individuals differ?</li>
</ul>
<hr>
<section id="movement-data-unique-challenges" class="level4">
<h4 class="anchored" data-anchor-id="movement-data-unique-challenges">Movement Data: Unique Challenges</h4>
<p><strong>Multiple sources of autocorrelation:</strong></p>
<ol type="1">
<li><strong>Temporal:</strong> Location at <span class="math inline">\(t\)</span> depends on <span class="math inline">\(t-1\)</span></li>
<li><strong>Spatial:</strong> Nearby environmental conditions are similar</li>
<li><strong>Individual:</strong> Each animal has consistent behavior</li>
</ol>
<p><strong>Observation models:</strong></p>
<ul>
<li>GPS error (location uncertainty)</li>
<li>Irregular sampling intervals</li>
<li>Missing data</li>
</ul>
<p>Standard spatial models don‚Äôt account for movement process!</p>
<hr>
</section>
<section id="movement-data-method-1---step-selection-functions" class="level3">
<h3 class="anchored" data-anchor-id="movement-data-method-1---step-selection-functions">Movement Data: Method 1 - Step Selection Functions</h3>
<p><strong>Idea:</strong> Model animal‚Äôs choice among available steps at each time point</p>
<p><span class="math display">\[w(\mathbf{s}_t | \mathbf{s}_{t-1}) \propto \exp(\beta_1 x_1(\mathbf{s}_t) + ... + \beta_p x_p(\mathbf{s}_t))\]</span></p>
<p><strong>Steps:</strong></p>
<ol type="1">
<li>For each observed step, generate ‚Äúavailable‚Äù alternative steps</li>
<li>Compare chosen vs available using conditional logistic regression</li>
<li>Covariates describe step characteristics (length, angle, habitat)</li>
</ol>
<p><strong>Interpretation:</strong> Habitat selection during movement</p>
<hr>
<section id="step-selection-functions-details" class="level4">
<h4 class="anchored" data-anchor-id="step-selection-functions-details">Step Selection Functions: Details</h4>
<p><strong>Used step:</strong> What the animal actually did <span class="math display">\[\text{step length}, \quad \text{turn angle}, \quad \text{end habitat}\]</span></p>
<p><strong>Available steps:</strong> What it could have done</p>
<ul>
<li>Sample from movement kernel (e.g., gamma distribution for length)</li>
<li>Usually 10-100 available steps per used step</li>
</ul>
<p><strong>Model:</strong></p>
<p><span class="math display">\[\text{Pr(step chosen)} = \frac{\exp(\mathbf{X}\boldsymbol{\beta})}{\sum_{j=1}^n \exp(\mathbf{X}_j\boldsymbol{\beta})}\]</span></p>
<hr>
</section>
<section id="ssf-r-example" class="level4">
<h4 class="anchored" data-anchor-id="ssf-r-example">SSF: R Example</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(amt)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare tracking data</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>track <span class="ot">&lt;-</span> <span class="fu">make_track</span>(gps_data, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.x =</span> x, <span class="at">.y =</span> y, <span class="at">.t =</span> timestamp,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">id =</span> animal_id, <span class="at">crs =</span> <span class="dv">32612</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create steps</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">&lt;-</span> track <span class="sc">%&gt;%</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">steps_by_burst</span>()</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random available steps (20 per used)</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>rand_steps <span class="ot">&lt;-</span> steps <span class="sc">%&gt;%</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">random_steps</span>(<span class="at">n_control =</span> <span class="dv">20</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract habitat at end of each step</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>rand_steps <span class="ot">&lt;-</span> rand_steps <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_covariates</span>(habitat_raster) <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_covariates</span>(elevation_raster)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit conditional logistic regression (step selection function)</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>ssf_model <span class="ot">&lt;-</span> rand_steps <span class="sc">%&gt;%</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_clogit</span>(case_ <span class="sc">~</span> </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>               forest <span class="sc">+</span> </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>               elevation <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>               <span class="fu">I</span>(elevation<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>               sl_ <span class="sc">+</span> log_sl_ <span class="sc">+</span>  <span class="co"># Step length terms</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>               cos_ta_ <span class="sc">+</span>         <span class="co"># Turn angle</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>               <span class="fu">strata</span>(step_id_))</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ssf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="movement-data-method-2---state-space-models" class="level3">
<h3 class="anchored" data-anchor-id="movement-data-method-2---state-space-models">Movement Data: Method 2 - State-Space Models</h3>
<p><strong>Two-level model:</strong></p>
<ol type="1">
<li><p><strong>Movement process</strong> (latent true locations): <span class="math display">\[\mathbf{s}_t = \mathbf{s}_{t-1} + \mathbf{v}_t\]</span></p></li>
<li><p><strong>Observation process</strong> (GPS measurements): <span class="math display">\[\mathbf{y}_t = \mathbf{s}_t + \boldsymbol{\epsilon}_t\]</span></p></li>
</ol>
<p><strong>Advantages:</strong></p>
<ul>
<li>Accounts for GPS error</li>
<li>Handles irregular sampling</li>
<li>Can incorporate behavior</li>
<li>Smooths erratic paths</li>
</ul>
<hr>
<section id="state-space-models-behavioral-states" class="level4">
<h4 class="anchored" data-anchor-id="state-space-models-behavioral-states">State-Space Models: Behavioral States</h4>
<p><strong>Hidden Markov Models (HMM):</strong> Switch between behavioral states</p>
<p><strong>Example states:</strong></p>
<ul>
<li>Encamped (resting, feeding)</li>
<li>Exploratory (traveling, migrating)</li>
</ul>
<p><strong>Each state has different movement parameters:</strong></p>
<ul>
<li>State 1: Short steps, high turning</li>
<li>State 2: Long steps, low turning</li>
</ul>
<p><span class="math display">\[\begin{bmatrix}
p_{11} &amp; p_{12} \\
p_{21} &amp; p_{22}
\end{bmatrix} \leftarrow \text{Transition matrix}\]</span></p>
<hr>
</section>
<section id="state-space-model-r-example" class="level4">
<h4 class="anchored" data-anchor-id="state-space-model-r-example">State-Space Model: R Example</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(momentuHMM)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">prepData</span>(gps_data,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">"UTM"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">coordNames =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define 2-state model parameters</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># State 1: encamped, State 2: traveling</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step length distributions (Gamma)</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>stepPar0 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_state1 =</span> <span class="dv">100</span>,   <span class="co"># Short steps when encamped</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_state2 =</span> <span class="dv">1000</span>,  <span class="co"># Long steps when traveling</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_state1 =</span> <span class="dv">50</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_state2 =</span> <span class="dv">500</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Turning angle distributions (von Mises)</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>anglePar0 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_state1 =</span> <span class="dv">0</span>,     <span class="co"># Random turning</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_state2 =</span> <span class="dv">0</span>,     <span class="co"># Directional</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">concentration_state1 =</span> <span class="fl">0.1</span>,  <span class="co"># Low concentration</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">concentration_state2 =</span> <span class="fl">0.8</span>   <span class="co"># High concentration</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit HMM</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>hmm_fit <span class="ot">&lt;-</span> <span class="fu">fitHMM</span>(</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbStates =</span> <span class="dv">2</span>,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist =</span> <span class="fu">list</span>(<span class="at">step =</span> <span class="st">"gamma"</span>, <span class="at">angle =</span> <span class="st">"vm"</span>),</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">Par0 =</span> <span class="fu">list</span>(<span class="at">step =</span> stepPar0, <span class="at">angle =</span> anglePar0)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Decode states (Viterbi algorithm)</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">viterbi</span>(hmm_fit)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hmm_fit)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="fu">plotStates</span>(hmm_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="movement-data-method-3---continuous-time-models" class="level3">
<h3 class="anchored" data-anchor-id="movement-data-method-3---continuous-time-models">Movement Data: Method 3 - Continuous-Time Models</h3>
<p><strong>Problem:</strong> Discrete-time models assume regular intervals</p>
<p><strong>Solution:</strong> Continuous-time movement models handle irregular sampling</p>
<p><strong>Common approach:</strong> Ornstein-Uhlenbeck process</p>
<p><span class="math display">\[d\mathbf{s}_t = -\mathbf{B}(\mathbf{s}_t - \boldsymbol{\mu})dt + \boldsymbol{\Sigma}^{1/2}d\mathbf{W}_t\]</span></p>
<p><strong>Interpretation:</strong></p>
<ul>
<li><span class="math inline">\(\boldsymbol{\mu}\)</span> = ‚Äúhome range center‚Äù</li>
<li><span class="math inline">\(\mathbf{B}\)</span> = rate of return to center</li>
<li><span class="math inline">\(\boldsymbol{\Sigma}\)</span> = movement variability</li>
</ul>
<hr>
<section id="continuous-time-ctmm-package" class="level4">
<h4 class="anchored" data-anchor-id="continuous-time-ctmm-package">Continuous-Time: ctmm Package</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ctmm)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare telemetry object</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>telemetry_obj <span class="ot">&lt;-</span> <span class="fu">as.telemetry</span>(gps_data)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit variogram (explore temporal autocorrelation)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>vario <span class="ot">&lt;-</span> <span class="fu">variogram</span>(telemetry_obj)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vario)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Guess movement model parameters</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>guess <span class="ot">&lt;-</span> <span class="fu">ctmm.guess</span>(telemetry_obj, </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">interactive =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Ornstein-Uhlenbeck model</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>fit_ou <span class="ot">&lt;-</span> <span class="fu">ctmm.fit</span>(telemetry_obj, guess)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate home range</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>home_range <span class="ot">&lt;-</span> <span class="fu">akde</span>(telemetry_obj, fit_ou)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(home_range)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ou)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(home_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="movement-data-method-4---integrated-models" class="level3">
<h3 class="anchored" data-anchor-id="movement-data-method-4---integrated-models">Movement Data: Method 4 - Integrated Models</h3>
<p><strong>Combine step selection with state-space models</strong></p>
<p><strong>Advantages:</strong></p>
<ul>
<li>SSF for habitat selection</li>
<li>State-space for behavioral states and GPS error</li>
<li>Best of both worlds!</li>
</ul>
<p><strong>Implementation:</strong></p>
<ul>
<li><code>bsam</code> package (Bayesian state-space models)</li>
<li>Custom JAGS/Stan models</li>
<li><code>crawl</code> package for state-space + habitat</li>
</ul>
<hr>
<section id="movement-data-comparison" class="level4">
<h4 class="anchored" data-anchor-id="movement-data-comparison">Movement Data: Comparison</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Temporal Structure</th>
<th>Habitat Selection</th>
<th>Behavioral States</th>
<th>GPS Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SSF</td>
<td>Discrete steps</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr class="even">
<td>HMM</td>
<td>Discrete time</td>
<td>Possible</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr class="odd">
<td>State-Space</td>
<td>Continuous</td>
<td>Limited</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Integrated</td>
<td>Both</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p><strong>Start Simple</strong> Begin with SSF for habitat selection, add state-space if GPS error or behavioral switching is important.</p>
<hr>
</section>
</section>
</section>
<section id="integrating-across-data-types" class="level2">
<h2 class="anchored" data-anchor-id="integrating-across-data-types">Integrating Across Data Types</h2>
<p><em>Real ecological studies often involve multiple spatial data types</em></p>
<hr>
<section id="multi-scale-multi-type-integration" class="level3">
<h3 class="anchored" data-anchor-id="multi-scale-multi-type-integration">Multi-Scale / Multi-Type Integration</h3>
<p><strong>Common scenarios:</strong></p>
<ol type="1">
<li><strong>Point + Areal:</strong> Bird surveys (points) + land cover (areal)</li>
<li><strong>Point + Movement:</strong> Home range (movement) + resource selection (points)</li>
<li><strong>Point Pattern + Covariates:</strong> Tree locations + soil maps</li>
<li><strong>Movement + Remote Sensing:</strong> Tracks + NDVI time series</li>
</ol>
<p><strong>The Challenge</strong> Different data types have different spatial support, resolution, and uncertainty.</p>
<hr>
</section>
<section id="integration-approach-1-change-of-support" class="level3">
<h3 class="anchored" data-anchor-id="integration-approach-1-change-of-support">Integration Approach 1: Change of Support</h3>
<p><strong>Problem:</strong> Data at different spatial scales</p>
<p><strong>Example:</strong> - Response: Point-level species occurrence - Covariates: Areal land cover by county</p>
<p><strong>Solutions:</strong></p>
<ol type="1">
<li><strong>Aggregate points to areal units</strong> (lose resolution)</li>
<li><strong>Downscale areal to points</strong> (assumes homogeneity)</li>
<li><strong>Model explicitly with geostatistical fusion</strong> (best but complex)</li>
</ol>
<hr>
</section>
<section id="integration-approach-2-joint-likelihood-models" class="level3">
<h3 class="anchored" data-anchor-id="integration-approach-2-joint-likelihood-models">Integration Approach 2: Joint Likelihood Models</h3>
<p><strong>Idea:</strong> Model all data types simultaneously with shared parameters</p>
<p><strong>Example:</strong> Integrated Species Distribution Model (ISDM)</p>
<ul>
<li>Data source 1: Structured surveys (presence-absence)</li>
<li>Data source 2: Opportunistic sightings (presence-only)<br>
</li>
<li>Data source 3: Telemetry tracks (habitat use)</li>
</ul>
<p><strong>Shared parameter:</strong> True intensity/abundance surface <span class="math inline">\(\lambda(\mathbf{s})\)</span></p>
<p><strong>Implementation:</strong> <code>PointedSDMs</code> package in R</p>
<hr>
</section>
<section id="integration-approach-3-spatial-misalignment" class="level3">
<h3 class="anchored" data-anchor-id="integration-approach-3-spatial-misalignment">Integration Approach 3: Spatial Misalignment</h3>
<p><strong>When spatial supports don‚Äôt match:</strong></p>
<p><span class="math display">\[\begin{aligned}
\text{Point data:} \quad &amp; Y_p(\mathbf{s}) = f(\lambda(\mathbf{s})) \\
\text{Areal data:} \quad &amp; Y_A(R) = g\left(\int_R \lambda(\mathbf{s})d\mathbf{s}\right)
\end{aligned}\]</span></p>
<p><strong>Model latent process <span class="math inline">\(\lambda(\mathbf{s})\)</span> and link to both:</strong></p>
<ul>
<li>Point process observation model</li>
<li>Aggregation to areal support</li>
</ul>
<p><strong>Package:</strong> <code>areal</code> in R for interpolation</p>
<hr>
<section id="practical-integration-example" class="level4">
<h4 class="anchored" data-anchor-id="practical-integration-example">Practical Integration Example</h4>
<p><strong>Scenario:</strong> Modeling lynx habitat selection</p>
<p><strong>Data sources:</strong></p>
<ol type="1">
<li>GPS telemetry (movement data)</li>
<li>Camera trap detections (point pattern)</li>
<li>Forest cover by grid cell (areal)</li>
<li>Prey abundance point surveys (point-referenced)</li>
</ol>
<p><strong>Approach:</strong></p>
<ol type="1">
<li>Use SSF for fine-scale habitat selection from GPS</li>
<li>Use LGCP for broad-scale intensity from cameras</li>
<li>Extract covariates from areal forest data</li>
<li>Create prey abundance surface from surveys (kriging/SPDE)</li>
<li>Link all through shared spatial random effect</li>
</ol>
<hr>
</section>
</section>
</section>
<section id="model-selection-and-validation" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-and-validation">Model Selection and Validation</h2>
<p><em>How do we choose and evaluate spatial models?</em></p>
<hr>
<section id="validation-for-spatial-data" class="level3">
<h3 class="anchored" data-anchor-id="validation-for-spatial-data">Validation for Spatial Data</h3>
</section>
</section>
<section id="critical-issue" class="level2">
<h2 class="anchored" data-anchor-id="critical-issue">Critical Issue</h2>
<p>Standard cross-validation is <strong>wrong</strong> for spatial data!</p>
<p>Nearby points are autocorrelated, so ‚Äútest‚Äù data are not independent of ‚Äútraining‚Äù data.</p>
<p><strong>Solution:</strong> Spatial cross-validation</p>
<ul>
<li><strong>Spatial blocking:</strong> Leave out spatial blocks</li>
<li><strong>Leave-location-out:</strong> Remove all data near test points</li>
<li><strong>Clustered CV:</strong> Remove spatial clusters</li>
</ul>
<hr>
<section id="spatial-cross-validation-methods" class="level4">
<h4 class="anchored" data-anchor-id="spatial-cross-validation-methods">Spatial Cross-Validation Methods</h4>
<p><strong>1. Spatial blocking:</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(blockCV)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create spatial blocks</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>blocks <span class="ot">&lt;-</span> <span class="fu">cv_spatial</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> species_data,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">column =</span> <span class="st">"presence"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">5</span>,              <span class="co"># 5-fold CV</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">50000</span>,       <span class="co"># 50km blocks</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">selection =</span> <span class="st">"random"</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Use blocks for CV</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">cv_spatial_fold</span>(</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  model, blocks</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>2. Leave-region-out:</strong> - Hold out entire regions (e.g., one study site) - Tests spatial transferability</p>
<hr>
</section>
<section id="model-comparison-for-spatial-models" class="level3">
<h3 class="anchored" data-anchor-id="model-comparison-for-spatial-models">Model Comparison for Spatial Models</h3>
<p><strong>Information criteria:</strong></p>
<ul>
<li><strong>WAIC</strong> (Widely Applicable IC) - for Bayesian models</li>
<li><strong>DIC</strong> - Bayesian, but can be problematic for spatial models</li>
<li><strong>Spatial AIC</strong> - adjusts for effective sample size</li>
</ul>
<p><strong>Predictive performance:</strong></p>
<ul>
<li>Mean squared prediction error (MSPE)</li>
<li>Continuous ranked probability score (CRPS)</li>
<li>Log-likelihood on held-out data</li>
</ul>
<p><strong>Best Practice</strong> Use spatial CV + predictive metrics, not just information criteria.</p>
<hr>
<section id="diagnosing-spatial-model-fit" class="level4">
<h4 class="anchored" data-anchor-id="diagnosing-spatial-model-fit">Diagnosing Spatial Model Fit</h4>
<p><strong>Check residual autocorrelation:</strong></p>
<ol type="1">
<li><strong>Moran‚Äôs I test</strong></li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(<span class="fu">residuals</span>(model), <span class="fu">nb2listw</span>(neighbors))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><strong>Variogram of residuals</strong></li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">variogram</span>(residuals <span class="sc">~</span> <span class="dv">1</span>, <span class="at">locations =</span> <span class="sc">~</span>x<span class="sc">+</span>y, <span class="at">data =</span> data)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(v)  <span class="co"># Should be flat if spatial structure captured</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li><strong>Spatial correlograms</strong></li>
</ol>
<p>Residuals should show <strong>no</strong> spatial autocorrelation if model is adequate!</p>
<hr>
</section>
</section>
</section>
<section id="computational-considerations" class="level2">
<h2 class="anchored" data-anchor-id="computational-considerations">Computational Considerations</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Data Type</th>
<th>Typical n</th>
<th>Fast Methods</th>
<th>Slow but Flexible</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Point-referenced</td>
<td>100-10,000</td>
<td>Splines (mgcv), SPDE</td>
<td>Full GP</td>
</tr>
<tr class="even">
<td>Areal</td>
<td>50-5,000</td>
<td>CAR (INLA), MEM</td>
<td>Complex interaction models</td>
</tr>
<tr class="odd">
<td>Point pattern</td>
<td>100-100,000</td>
<td>Discretized LGCP</td>
<td>True LGCP</td>
</tr>
<tr class="even">
<td>Movement</td>
<td>1,000-100,000</td>
<td>SSF, HMM</td>
<td>State-space, continuous-time</td>
</tr>
</tbody>
</table>
<p><strong>Modern Trend</strong> Approximate methods (INLA, SPDE, low-rank GPs) make complex spatial models feasible for large ecological datasets.</p>
<hr>
<section id="software-summary" class="level3">
<h3 class="anchored" data-anchor-id="software-summary">Software Summary</h3>
<p><strong>R Packages by data type:</strong></p>
<p><strong>Point-referenced:</strong> <code>mgcv</code>, <code>INLA</code>, <code>inlabru</code>, <code>gstat</code>, <code>spBayes</code></p>
<p><strong>Areal:</strong> <code>INLA</code>, <code>CARBayes</code>, <code>spdep</code>, <code>adespatial</code></p>
<p><strong>Point pattern:</strong> <code>spatstat</code>, <code>inlabru</code>, <code>ppmlasso</code></p>
<p><strong>Movement:</strong> <code>amt</code>, <code>momentuHMM</code>, <code>ctmm</code>, <code>crawl</code>, <code>adehabitatLT</code></p>
<p><strong>Multi-purpose:</strong> <code>sf</code>, <code>terra</code>, <code>sp</code> (spatial data structures)</p>
<hr>
</section>
</section>
<section id="recommended-workflow" class="level2">
<h2 class="anchored" data-anchor-id="recommended-workflow">Recommended Workflow</h2>
<ol type="1">
<li><strong>Visualize data</strong> - maps, variograms, spatial correlograms</li>
<li><strong>Start simple</strong> - non-spatial model, then add space</li>
<li><strong>Choose method</strong> based on data type and question</li>
<li><strong>Fit multiple models</strong> - compare approaches</li>
<li><strong>Validate spatially</strong> - spatial CV or block CV</li>
<li><strong>Diagnose residuals</strong> - check for remaining spatial structure</li>
<li><strong>Interpret carefully</strong> - spatial effects ‚â† causal mechanisms</li>
</ol>
<p><strong>Don‚Äôt Overfit!</strong> More complex ‚â† better. Use simplest model that captures spatial structure.</p>
<hr>
<section id="common-pitfalls" class="level3">
<h3 class="anchored" data-anchor-id="common-pitfalls">Common Pitfalls</h3>
</section>
</section>
<section id="watch-out-for-1" class="level2">
<h2 class="anchored" data-anchor-id="watch-out-for-1">Watch Out For:</h2>
<ol type="1">
<li><strong>Confounding:</strong> Spatial effects absorbing true covariate effects</li>
<li><strong>Edge effects:</strong> Boundary areas have high uncertainty</li>
<li><strong>Non-stationarity:</strong> Spatial structure varies across landscape</li>
<li><strong>Anisotropy:</strong> Spatial correlation depends on direction</li>
<li><strong>Computational limits:</strong> Be realistic about data size</li>
<li><strong>Over-smoothing:</strong> Too much spatial structure removes real variation</li>
<li><strong>Ignoring uncertainty:</strong> Report it! Especially for predictions</li>
</ol>
<hr>
<section id="when-to-use-each-data-type-approach" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-each-data-type-approach">When to Use Each Data Type Approach</h3>
<p><strong>Use point-referenced methods when:</strong> - You have lat/lon coordinates from surveys - Want to predict continuous surface - Sample size: 50-10,000 locations</p>
<p><strong>Use areal methods when:</strong> - Data aggregated to regions/cells - Clear neighborhood structure - Often: count data, rare events</p>
<p><strong>Use point pattern methods when:</strong> - Locations are the outcome of interest - Want to model spatial intensity - Concern: point-to-point interactions</p>
<p><strong>Use movement methods when:</strong> - Tracking individuals over time - Interested in habitat selection during movement - Need to account for temporal autocorrelation</p>
<hr>
<section id="future-directions" class="level4">
<h4 class="anchored" data-anchor-id="future-directions">Future Directions</h4>
<p><strong>Emerging methods:</strong></p>
<ul>
<li>Deep learning for spatial prediction</li>
<li>Spatial conformal inference (uncertainty quantification)</li>
<li>Multi-resolution models</li>
<li>Non-stationary spatial processes</li>
<li>Real-time spatial models (citizen science, camera traps)</li>
<li>Massive-scale spatial models (&gt;1 million locations)</li>
</ul>
<p><strong>Software development:</strong></p>
<ul>
<li>Better integration across data types</li>
<li>User-friendly interfaces for complex models</li>
<li>Improved computational efficiency</li>
</ul>
<hr>
</section>
</section>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
</section>
<section id="remember" class="level2">
<h2 class="anchored" data-anchor-id="remember">Remember:</h2>
<ol type="1">
<li><strong>Data structure determines appropriate methods</strong> - identify your data type first</li>
<li><strong>Start simple, add complexity as needed</strong> - parsimony matters</li>
<li><strong>Validate spatially</strong> - standard CV fails with spatial data</li>
<li><strong>Computational feasibility</strong> - consider dataset size and resources</li>
<li><strong>Interpretation</strong> - spatial structure helps prediction but may obscure causation</li>
<li><strong>Residual diagnostics</strong> - always check for remaining spatial autocorrelation</li>
</ol>
<hr>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p><strong>Books:</strong></p>
<ul>
<li>Banerjee et al.&nbsp;(2014) <em>Hierarchical Modeling and Analysis for Spatial Data</em></li>
<li>Cressie &amp; Wikle (2011) <em>Statistics for Spatio-Temporal Data</em></li>
<li>Illian et al.&nbsp;(2008) <em>Statistical Analysis and Modelling of Spatial Point Patterns</em></li>
</ul>
<p><strong>Papers:</strong></p>
<ul>
<li>Lindgren et al.&nbsp;(2011) ‚ÄúAn explicit link between Gaussian fields and Gaussian Markov random fields‚Äù <em>JRSS-B</em></li>
<li>Hooten et al.&nbsp;(2017) ‚ÄúAnimal Movement Models for Spatial Ecology‚Äù <em>Wiley</em></li>
</ul>
<p><strong>Online:</strong></p>
<ul>
<li><a href="https://www.r-inla.org/">R-INLA documentation</a></li>
<li><a href="https://noamross.github.io/gams-in-r-course/">mgcv course</a></li>
<li><a href="https://r-spatial.org/book/">Spatial Data Science book</a></li>
</ul>
<hr>
</section>
<section id="questions" class="level2">
<h2 class="anchored" data-anchor-id="questions">Questions?</h2>
</section>
<section id="contact-discussion" class="level2">
<h2 class="anchored" data-anchor-id="contact-discussion">Contact &amp; Discussion</h2>
<ul>
<li>Email: your.email@institution.edu</li>
<li>Website: www.yourwebsite.com</li>
<li>GitHub: <span class="citation" data-cites="yourusername">@yourusername</span></li>
</ul>
<p><strong>What spatial data challenges are you facing?</strong></p>
<p>Let‚Äôs discuss specific applications to your research!</p>
<p><strong>Thank you!</strong></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>